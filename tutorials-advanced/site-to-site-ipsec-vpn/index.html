<!doctype html><html lang=en class="js csstransforms3d">
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.88.1">
<meta name=description content>
<link rel=icon href=/images/favicon.png type=image/png>
<title>The Site to Site IPSec VPN :: Ventus Docs</title>
<link href=/css/nucleus.css?1635706399 rel=stylesheet>
<link href=/css/fontawesome-all.min.css?1635706399 rel=stylesheet>
<link href=/css/hybrid.css?1635706399 rel=stylesheet>
<link href=/css/featherlight.min.css?1635706399 rel=stylesheet>
<link href=/css/perfect-scrollbar.min.css?1635706399 rel=stylesheet>
<link href=/css/auto-complete.css?1635706399 rel=stylesheet>
<link href=/css/atom-one-dark-reasonable.css?1635706399 rel=stylesheet>
<link href=/css/theme.css?1635706399 rel=stylesheet>
<link href=/css/tabs.css?1635706399 rel=stylesheet>
<link href=/css/hugo-theme.css?1635706399 rel=stylesheet>
<link href=/css/theme-blue.css?1635706399 rel=stylesheet>
<script src=/js/jquery-3.3.1.min.js?1635706399></script>
<style>:root #header+#content>#left>#rlblock_left{display:none!important}</style>
</head>
<body data-url=/tutorials-advanced/site-to-site-ipsec-vpn/>
<nav id=sidebar>
<div id=header-wrapper>
<div id=header><svg width="260" height="62" viewBox="0 0 420 62" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M75.4 14C73.8 14 72.6 15.2 72.6 16.8 72.6 18.4 73.8 19.6 75.4 19.6 81.6 19.6 86.6 24.6 86.6 30.8S81.5 42 75.4 42H26.3c-1.6.0-2.8 1.2-2.8 2.8.0 1.6 1.2 2.8 2.8 2.8H75.4c9.3.0 16.9-7.5 16.9-16.9C92.2 21.5 84.7 14 75.4 14z" fill="#fff"/><path d="M16.8 42.1H2.8C1.2 42.1.0 43.3.0 44.9s1.2 2.8 2.8 2.8h14c1.6.0 2.8-1.2 2.8-2.8s-1.2-2.8-2.8-2.8z" fill="#fff"/><path d="M15.7 33.7H49.4c9.2.0 16.8-7.5 16.9-16.9V16.6C66.3 7.49999 58.9.0 49.7.0 40.6.0 33.1 7.39999 33.1 16.6V17.4c0 1.6 1.2 2.8 2.8 2.8s2.8-1.2 2.8-2.8V16.6c0-6 4.9-10.9 10.9-10.9s10.9 4.9 10.9 10.9V16.8C60.5 23 55.4 28 49.3 28H15.6c-1.6.0-2.8 1.2-2.8 2.8.0 1.6 1.3 2.9 2.9 2.9z" fill="#fff"/><path d="M361.3 10.8C357.5 10.8 353.5 11.4 349.5 12.6v5.3C353.5 16.7 357.4 16.1 361.3 16.1 368 16.1 371.3 18.2 371.3 22.5V26C368.1 25.5 364.8 25.3 361.6 25.3c-10.1.0-15.1 3.8-15.1 11.5C346.5 44.3 350.9 48 359.8 48 363.9 48 367.8 46.9 371.3 44.7 371.3 44.9 371.3 45.1 371.3 45.4 371.3 46.9 372.6 48 374.1 48H377.8V28.9 22.3C377.9 14.6 372.3 10.8 361.3 10.8zm10 28.3C368.2 41.5 364.3 42.7 359.8 42.7S353.1 40.7 353.1 36.7 355.9 30.7 361.6 30.7C364.8 30.7 368.1 30.9 371.3 31.4v7.7z" fill="#fff"/><path d="M99.3 10.8h4.3C105.2 10.8 106.9 12 107.4 13.5L117.1 40 126.7 13.5c.5-1.5 2.2-2.7 3.8-2.7H134.8L120.7 45.4C120.1 46.8 118.4 48 116.8 48H116.4C114.8 48 113.1 46.8 112.6 45.4L99.3 10.8z" fill="#fff"/><path d="M171.3 26.5C171.3 16 166 10.8 155.4 10.8c-11.4.0-17.1 6.1-17.1 18.2C138.3 41.7 144.7 48 157.5 48 162.2 48 166.2 47.5 169.5 46.6V41.3C166.2 42.2 162.5 42.7 158.2 42.7 149.3 42.7 144.9 38.9 144.9 31.3H171C171.2 29.6 171.3 28 171.3 26.5zM144.9 25.8C145.3 19.3 148.8 16 155.5 16 161.7 16 164.9 19.3 165.1 25.8H144.9z" fill="#fff"/><path d="M305.2 26.4H299.9C296 26.4 294 24.7 294 21.4 294 17.9 297.1 16.1 303.3 16.1 307.7 16.1 312.2 16.8 316.5 18.2V12.5C312.1 11.3 307.7 10.7 303.3 10.7c-10.3.0-15.5 3.5-15.5 10.6.0 7.3 4 11 12.1 11H305.2C309.3 32.3 311.4 34 311.4 37.3 311.4 40.8 308.4 42.6 302.5 42.6 298 42.6 293.6 41.9 289.2 40.5v5.7C293.6 47.4 298 48 302.5 48c10.3.0 15.5-3.5 15.5-10.6C318 30 313.7 26.4 305.2 26.4z" fill="#fff"/><path d="M405.4 10.8c-12.4.0-18.6 6.1-18.6 18.4C386.8 41.8 392.7 48 404.5 48 407.7 48 410.7 47.4 413.5 46.2V48c0 5.4-3.5 8.2-10.5 8.2C398.4 56.2 394.3 55.6 390.7 54.4v5.3C394.2 60.9 398.3 61.5 402.9 61.5 414.3 61.5 420 57 420 48V12.3C415.3 11.3 410.4 10.8 405.4 10.8zm8 29.6C410.8 41.7 407.8 42.3 404.4 42.3c-7.5.0-11.2-4.4-11.2-13.2.0-8.6 4-12.9 11.9-12.9C408.4 16.2 411.2 16.5 413.4 17.1V40.4v0z" fill="#fff"/><path d="M198.3 10.8C194.1 10.8 190.3 12.1 186.7 14.8c0-.4.0-.9.0-1.4C186.7 11.9 185.4 10.8 183.9 10.8H180.2V48H186.8V20.9C190.2 17.8 193.8 16.2 197.5 16.2 203 16.2 205.8 19 205.8 24.5V48H212.4V24.6C212.3 15.4 207.6 10.8 198.3 10.8z" fill="#fff"/><path d="M229.5 16.1h9V10.8h-9V8.3c0-.4.0-.899990000000001.0-1.39999C229.5 6.10001 229.1 5.3 228.4 4.8V4.7H228.3C227.8 4.4 227.3 4.2 226.7 4.2H223v.5V37.9C223 44.6 226.1 47.9 232.4 47.9H238.6V42.6H234c-3 0-4.5-1.7-4.5-5.2V16.1z" fill="#fff"/><path d="M272.4 10.8V36.2v1.7C269 41 265.4 42.6 261.7 42.6 256.2 42.6 253.5 39.8 253.5 34.3V10.8H246.9V34.2C246.9 43.4 251.2 48.1 259.7 48.1 264 48.1 268.2 46.7 272.4 44V44.1C272.4 44.5 272.4 45 272.4 45.5 272.4 47 273.7 48.1 275.2 48.1H278.9V19.8 10.9h-6.5V10.8z" fill="#fff"/><path d="M335.9 47.9C337.723 47.9 339.2 46.4225 339.2 44.6S337.723 41.3 335.9 41.3C334.077 41.3 332.6 42.7775 332.6 44.6S334.077 47.9 335.9 47.9z" fill="#fff"/></svg>
</div>
<div class=searchbox>
<label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span>
</div>
<script type=text/javascript src=/js/lunr.min.js?1635706399></script>
<script type=text/javascript src=/js/auto-complete.js?1635706399></script>
<script type=text/javascript>var baseurl="https://docs.ventuscloud.eu/"</script>
<script type=text/javascript src=/js/search.js?1635706399></script>
</div>
<section id=homelinks>
<ul>
<li>
<a class=padding href=/><i class="fas fa-home"></i> Home</a>
</li>
</ul>
</section>
<div class=highlightable>
<ul class=topics>
<li data-nav-id=/getting-started/ title="Getting Started" class=dd-item>
<a href=/getting-started/>
<b>1. </b>Getting Started
</a>
<ul>
<li data-nav-id=/getting-started/account/ title=Account class=dd-item>
<a href=/getting-started/account/>
Account
</a>
</li>
<li data-nav-id=/getting-started/organizations/ title=Organizations class=dd-item>
<a href=/getting-started/organizations/>
Organizations
</a>
</li>
<li data-nav-id=/getting-started/projects/ title=Projects class=dd-item>
<a href=/getting-started/projects/>
Projects
</a>
</li>
</ul>
</li>
<li data-nav-id=/identity-management/ title="Identity Management" class=dd-item>
<a href=/identity-management/>
<b>2. </b>Identity Management
</a>
<ul>
<li data-nav-id=/identity-management/administrators/ title=Administrators class=dd-item>
<a href=/identity-management/administrators/>
Administrators
</a>
</li>
<li data-nav-id=/identity-management/groups/ title=Groups class=dd-item>
<a href=/identity-management/groups/>
Groups
</a>
</li>
</ul>
</li>
<li data-nav-id=/products/ title=Products class=dd-item>
<a href=/products/>
<b>3. </b>Products
</a>
<ul>
<li data-nav-id=/products/compute/ title=COMPUTE class=dd-item>
<a href=/products/compute/>
<b> </b>COMPUTE
</a>
<ul>
<li data-nav-id=/products/compute/virtual-machines/ title="Virtual Machines" class=dd-item>
<a href=/products/compute/virtual-machines/>
Virtual Machines
</a>
</li>
<li data-nav-id=/products/compute/connect-linux-vm/ title="Access Linux VM" class=dd-item>
<a href=/products/compute/connect-linux-vm/>
Access Linux VM
</a>
</li>
<li data-nav-id=/products/compute/connect-windows-vm/ title="Access Windows VM" class=dd-item>
<a href=/products/compute/connect-windows-vm/>
Access Windows VM
</a>
</li>
</ul>
</li>
<li data-nav-id=/products/kubernetes/ title=KUBERNETES class=dd-item>
<a href=/products/kubernetes/>
<b> </b>KUBERNETES
</a>
<ul>
<li data-nav-id=/products/kubernetes/kubernetes-cluster/ title="K8S Cluster" class=dd-item>
<a href=/products/kubernetes/kubernetes-cluster/>
K8S Cluster
</a>
</li>
<li data-nav-id=/products/kubernetes/accessing-kuber/ title="Access K8S Cluster" class=dd-item>
<a href=/products/kubernetes/accessing-kuber/>
Access K8S Cluster
</a>
</li>
</ul>
</li>
<li data-nav-id=/products/security/ title=SECURITY class=dd-item>
<a href=/products/security/>
<b> </b>SECURITY
</a>
<ul>
<li data-nav-id=/products/security/firewalls/ title=Firewalls class=dd-item>
<a href=/products/security/firewalls/>
Firewalls
</a>
</li>
<li data-nav-id=/products/security/firewall-rules/ title="Firewall Rules" class=dd-item>
<a href=/products/security/firewall-rules/>
Firewall Rules
</a>
</li>
<li data-nav-id=/products/security/manage-firewalls/ title="VM's Firewalls" class=dd-item>
<a href=/products/security/manage-firewalls/>
VM's Firewalls
</a>
</li>
<li data-nav-id=/products/security/ssh-keys/ title="SSH Keys" class=dd-item>
<a href=/products/security/ssh-keys/>
SSH Keys
</a>
</li>
<li data-nav-id=/products/security/cli-users/ title="CLI Users" class=dd-item>
<a href=/products/security/cli-users/>
CLI Users
</a>
</li>
</ul>
</li>
<li data-nav-id=/products/storage/ title=STORAGE class=dd-item>
<a href=/products/storage/>
<b> </b>STORAGE
</a>
<ul>
<li data-nav-id=/products/storage/object-storage/ title="Object Storage" class=dd-item>
<a href=/products/storage/object-storage/>
Object Storage
</a>
</li>
<li data-nav-id=/products/storage/object-storage-credentials/ title="Object Storage Credentials" class=dd-item>
<a href=/products/storage/object-storage-credentials/>
Object Storage Credentials
</a>
</li>
<li data-nav-id=/products/storage/volumes/ title=Volumes class=dd-item>
<a href=/products/storage/volumes/>
Volumes
</a>
</li>
<li data-nav-id=/products/storage/manage-volumes/ title="VM's Volumes" class=dd-item>
<a href=/products/storage/manage-volumes/>
VM's Volumes
</a>
</li>
<li data-nav-id=/products/storage/snapshots/ title=Snapshots class=dd-item>
<a href=/products/storage/snapshots/>
Snapshots
</a>
</li>
<li data-nav-id=/products/storage/manage-snapshots/ title="VM's Snapshots" class=dd-item>
<a href=/products/storage/manage-snapshots/>
VM's Snapshots
</a>
</li>
<li data-nav-id=/products/storage/custom-images/ title=Images class=dd-item>
<a href=/products/storage/custom-images/>
Images
</a>
</li>
</ul>
</li>
<li data-nav-id=/products/network/ title=NETWORK class=dd-item>
<a href=/products/network/>
<b> </b>NETWORK
</a>
<ul>
<li data-nav-id=/products/network/networks/ title=Networks class=dd-item>
<a href=/products/network/networks/>
Networks
</a>
</li>
<li data-nav-id=/products/network/subnets/ title=Subnets class=dd-item>
<a href=/products/network/subnets/>
Subnets
</a>
</li>
<li data-nav-id=/products/network/manage-networksinterfaces/ title="VM's Networks and Interfaces" class=dd-item>
<a href=/products/network/manage-networksinterfaces/>
VM's Networks and Interfaces
</a>
</li>
</ul>
</li>
</ul>
</li>
<li data-nav-id=/tutorials-advanced/ title=Advanced class="dd-item
parent">
<a href=/tutorials-advanced/>
<b>4. </b>Advanced
</a>
<ul>
<li data-nav-id=/tutorials-advanced/installation-openstack-cli/ title="Installation OpenStack CLI" class=dd-item>
<a href=/tutorials-advanced/installation-openstack-cli/>
Installation OpenStack CLI
</a>
</li>
<li data-nav-id=/tutorials-advanced/working-with-openstack-api/ title="Working with OpenStack API" class=dd-item>
<a href=/tutorials-advanced/working-with-openstack-api/>
Working with OpenStack API
</a>
</li>
<li data-nav-id=/tutorials-advanced/org-management-over-api/ title="Organization's management over API" class=dd-item>
<a href=/tutorials-advanced/org-management-over-api/>
Organization's management over API
</a>
</li>
<li data-nav-id=/tutorials-advanced/advanced-network-scenarios/ title="Advanced network scenarios" class=dd-item>
<a href=/tutorials-advanced/advanced-network-scenarios/>
Advanced network scenarios
</a>
</li>
<li data-nav-id=/tutorials-advanced/site-to-site-ipsec-vpn/ title="The Site to Site IPSec VPN" class="dd-item active">
<a href=/tutorials-advanced/site-to-site-ipsec-vpn/>
The Site to Site IPSec VPN
</a>
</li>
</ul>
</li>
<li data-nav-id=/terms-and-conditions/ title="Terms and Conditions" class=dd-item>
<a href=/terms-and-conditions/>
<b>5. </b>Terms and Conditions
</a>
<ul>
<li data-nav-id=/terms-and-conditions/privacy-policy/ title="Privacy Policy" class=dd-item>
<a href=/terms-and-conditions/privacy-policy/>
Privacy Policy
</a>
</li>
<li data-nav-id=/terms-and-conditions/terms-and-conditions/ title="Terms and Conditions" class=dd-item>
<a href=/terms-and-conditions/terms-and-conditions/>
Terms and Conditions
</a>
</li>
<li data-nav-id=/terms-and-conditions/devops-as-a-service/ title="Devops as a Service" class=dd-item>
<a href=/terms-and-conditions/devops-as-a-service/>
Devops as a Service
</a>
</li>
</ul>
</li>
<li data-nav-id=/release-notes/ title="Release Notes" class=dd-item>
<a href=/release-notes/>
<b>6. </b>Release Notes
</a>
<ul>
<li data-nav-id=/release-notes/ventus-console2.5.6/ title="Ventus Console 2.5.6" class=dd-item>
<a href=/release-notes/ventus-console2.5.6/>
Ventus Console 2.5.6
</a>
</li>
<li data-nav-id=/release-notes/ventus-console2.4.5/ title="Ventus Console 2.4.5" class=dd-item>
<a href=/release-notes/ventus-console2.4.5/>
Ventus Console 2.4.5
</a>
</li>
<li data-nav-id=/release-notes/ventus-console2.4.4/ title="Ventus Console 2.4.4" class=dd-item>
<a href=/release-notes/ventus-console2.4.4/>
Ventus Console 2.4.4
</a>
</li>
</ul>
</li>
</ul>
<section id=footer>
<p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p>
</section>
</div>
</nav>
<section id=body>
<div id=overlay></div>
<div class="padding highlightable">
<div>
<div id=top-bar>
<div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb>
<span id=sidebar-toggle-span>
<a href=# id=sidebar-toggle data-sidebar-toggle>
<i class="fas fa-bars"></i>
</a>
</span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>
<a href=/>Home Page</a> > <a href=/tutorials-advanced/>Advanced</a> > The Site to Site IPSec VPN
</span>
</div>
<div class=progress>
<div class=wrapper>
<nav id=TableOfContents>
<ul>
<li><a href=#prerequisites>Prerequisites</a></li>
<li><a href=#configure-site-to-site-ipsec-connection>Configure Site to Site IPSec connection</a></li>
<li><a href=#strongswan-useful-commands>Strongswan useful commands</a></li>
<li><a href=#capture-traffic>Capture traffic</a></li>
<li><a href=#disable-port-security>Disable port-security</a></li>
<li><a href=#preparing-client-side>Preparing client side</a></li>
<li><a href=#verifying-connectivity>Verifying connectivity</a></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id=head-tags>
</div>
<div id=body-inner>
<h1>
The Site to Site IPSec VPN
</h1>
<hr>
<p>On this page, you can find an explanation of how to configure Site to Site IPSec connection between the Ventus Cloud Regions.</p>
<h1 id=table-of-contents>Table of contents</h1>
<ol>
<li><a href=#prerequisites>Prerequisites</a></li>
<li><a href=#configure-site-to-site-ipsec-connection>Configure Site to Site IPSec connection</a></li>
<li><a href=#strongswan-useful-commands>Strongswan useful commands</a></li>
<li><a href=#capture-traffic>Capture traffic</a></li>
<li><a href=#disable-port-security>Disable port-security</a></li>
<li><a href=#preparing-client-side>Preparing client side</a></li>
<li><a href=#verifying-connectivity>Verifying connectivity</a></li>
</ol>
<h2 id=prerequisites>Prerequisites</h2>
<ol>
<li>Create a private network in each region. How to create a network see the articles - <a href=https://docs.ventuscloud.eu/products/network/networks/>Networks</a> and <a href=https://docs.ventuscloud.eu/products/network/subnets/>Subnets</a></li>
<li>Create two VMs in private and public networks based on Ubuntu 18.04 or higher in each region. How to create VMs see the article - <a href=https://docs.ventuscloud.eu/products/compute/virtual-machines/>Virtual Machines</a></li>
<li>For testing, need to create on each private network VM based on Windows or Linux</li>
</ol>
<h2 id=configure-site-to-site-ipsec-connection>Configure Site to Site IPSec connection</h2>
<p>Example network topology:
<img src="../../assets/images/tutorials/11.png?classes=border,shadow" alt></p>
<p><strong>Details of 2 sites</strong>:</p>
<p>Site A:</p>
<pre tabindex=0><code>Location: Gais, Switzerland
External IP: 178.238.1.68
Internal IP: 172.16.0.141
</code></pre><p>Site B:</p>
<pre tabindex=0><code>Location: Vienna, Austria
External IP: 88.218.54.237
Internal IP: 172.17.0.179
</code></pre><p><strong>Prerequisites for both VPN routers</strong>:</p>
<ol>
<li>Update your repository indexes and install Strongwan:</li>
</ol>
<pre tabindex=0><code>apt update &amp;&amp; sudo apt upgrade -y
apt install strongswan -y
</code></pre><ol start=2>
<li>Add the following kernel parameters:</li>
</ol>
<pre tabindex=0><code>cat &gt;&gt; /etc/sysctl.conf &lt;&lt; EOF
net.ipv4.ip_forward = 1
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0
EOF
</code></pre><ol start=3>
<li>Apply kernel parameters:</li>
</ol>
<pre tabindex=0><code>sysctl -p /etc/sysctl.conf
</code></pre><ol start=4>
<li>Create a preshared key that will use on both VPN routers:</li>
</ol>
<pre tabindex=0><code>openssl rand -base64 64
zfZL9********3E3EJew
</code></pre><p><strong>Configure Site A:</strong></p>
<ol>
<li>Add the following string to file /etc/ipsec.secrets</li>
</ol>
<pre tabindex=0><code>cat /etc/ipsec.secrets
# source      destination
178.238.1.68 88.218.54.237 : PSK &quot;zfZL9BtqVvCOD/zdvY4BMoDxMhUePPBS+DYxhGphXMqUZhTtMM5PEZS8zDBc3b1Vjdhev2exaPnXq+o3E3EJew&quot;
</code></pre><ol start=2>
<li>Add VPN configuration in /etc/ipsec.conf</li>
</ol>
<pre tabindex=0><code>cat /etc/ipsec.conf
# basic configuration
config setup
        charondebug=&quot;all&quot;
        uniqueids=yes
        strictcrlpolicy=no

# connection to amsterdam datacenter
conn gais-to-vienna
        authby=secret
        left=%defaultroute
        leftid=178.238.1.68
        leftsubnet=172.16.0.141/24
        right=88.218.55.94
        rightsubnet=172.17.0.179/24
        ike=aes256-sha2_256-modp1024!
        esp=aes256-sha2_256!
        keyingtries=0
        ikelifetime=1h
        lifetime=8h
        dpddelay=30
        dpdtimeout=120
        dpdaction=restart
        auto=start
</code></pre><p><strong>Configure Site B:</strong></p>
<ol>
<li>Add the following string to file /etc/ipsec.secrets</li>
</ol>
<pre tabindex=0><code>cat /etc/ipsec.secrets
# source      destination
88.218.54.237 178.238.1.68 : PSK &quot;zfZL9BtqVvCOD/zdvY4BMoDxMhUePPBS+DYxhGphXMqUZhTtMM5PEZS8zDBc3b1Vjdhev2exaPnXq+o3E3EJew&quot;
</code></pre><ol start=2>
<li>Add VPN configuration in /etc/ipsec.conf</li>
</ol>
<pre tabindex=0><code>cat /etc/ipsec.conf
# basic configuration
config setup
        charondebug=&quot;all&quot;
        uniqueids=yes
        strictcrlpolicy=no

# connection to amsterdam datacenter
conn vienna-to-gais
        authby=secret
        left=%defaultroute
        leftid=88.218.55.94
        leftsubnet=172.17.0.179/24
        right=178.238.1.68
        rightsubnet=172.16.0.194/24
        ike=aes256-sha2_256-modp1024!
        esp=aes256-sha2_256!
        keyingtries=0
        ikelifetime=1h
        lifetime=8h
        dpddelay=30
        dpdtimeout=120
        dpdaction=restart
        auto=start
</code></pre><p><strong>Start the VPN on both ends:</strong></p>
<pre tabindex=0><code>sudo ipsec restart
</code></pre><p><strong>Get the status of the tunnel Site A</strong>:</p>
<pre tabindex=0><code>sudo ipsec status
Security Associations (1 up, 0 connecting):
gais-to-vienna[294]: ESTABLISHED 4 minutes ago, 178.238.1.68[178.238.1.68]...88.218.55.94[88.218.55.94]
gais-to-vienna{285}: INSTALLED, TUNNEL, reqid 284, ESP SPIs: cdb16354_i c750e920_o
gais-to-vienna{285}: 172.16.0.0/24 === 172.17.0.0/24
</code></pre><p><strong>Get the status of the tunnel Site B</strong>:</p>
<pre tabindex=0><code>sudo ipsec status
Security Associations (1 up, 0 connecting):
vienna-to-gais[292]: ESTABLISHED 8 minutes ago, 88.218.55.94[88.218.55.94]...178.238.1.68[178.238.1.68]
vienna-to-gais{285}: INSTALLED, TUNNEL, reqid 284, ESP SPIs: c750e920_i cdb16354_o
vienna-to-gais{285}: 172.17.0.0/24 === 172.16.0.0/24
</code></pre><p><strong>Set the service to start on boot:</strong></p>
<pre tabindex=0><code>$ sudo systemctl enable strongswan
</code></pre><h2 id=strongswan-useful-commands>Strongswan useful commands</h2>
<ol>
<li>Start / Stop / Status:</li>
</ol>
<pre tabindex=0><code>sudo ipsec up connection-name
sudo ipsec down connection-name
sudo ipsec restart
sudo ipsec status
sudo ipsec statusall
</code></pre><ol start=2>
<li>Get the Policies and States of the IPsec Tunnel:</li>
</ol>
<pre tabindex=0><code>sudo ip xfrm state
sudo ip xfrm policy
</code></pre><ol start=3>
<li>Reload the secrets, while the service is running:</li>
</ol>
<pre tabindex=0><code>sudo ipsec rereadsecrets
</code></pre><h2 id=capture-traffic>Capture traffic</h2>
<p>To capture traffic from the tunnel, use the command:</p>
<pre tabindex=0><code>sudo tcpdump esp
</code></pre><h2 id=disable-port-security>Disable port-security</h2>
<p>To disable port-security in internal networks for VPN routers and clients, do the following:</p>
<ol>
<li>
<p>Create API user and install OpenStack CLI. To find more detailed instructions see the article - <a href=https://docs.ventuscloud.eu/tutorials-advanced/installation-openstack-cli/>Installation OpenStack CLI</a>.<br>
In each region need to create its own API user.<br>
This example shows how to disable port security in Eastern-Switzerland region.</p>
</li>
<li>
<p>Show port list:</p>
</li>
</ol>
<pre tabindex=0><code>openstack port list
+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+
| ID | Name | MAC Address | Fixed IP Addresses | Status |
+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+
| 0648a6fe-0f82-421e-8788-a3bc6ba44f14 | | fa:16:3e:36:5d:1c | ip_address='172.16.0.101', subnet_id='4494fca5-92ba-4831-8522-effa5256b8db' | ACTIVE |
| 4eb09249-7800-46a1-82b5-d739af048313 | | fa:16:3e:65:05:f3 | ip_address='172.16.0.100', subnet_id='4494fca5-92ba-4831-8522-effa5256b8db' | ACTIVE |
| 5e1a6b90-bc0e-40a1-811a-d20ff956fa42 | | fa:16:3e:ee:4a:66 | ip_address='172.16.0.102', subnet_id='4494fca5-92ba-4831-8522-effa5256b8db' | ACTIVE |
| 5eaed158-bd0b-4e9e-88d2-7c94c124efae | | fa:16:3e:b8:9f:bf | ip_address='172.16.0.164', subnet_id='4494fca5-92ba-4831-8522-effa5256b8db' | ACTIVE |
| 681ab50b-31ee-4008-b378-353fc132adbb | | fa:16:3e:42:2a:75 | ip_address='178.238.1.68', subnet_id='d447edae-1d21-4f83-9f67-2060ddb5930a' | ACTIVE |
| 72828020-8826-4bd0-b99d-d014685678dd | | fa:16:3e:22:22:ea | ip_address='172.16.0.141', subnet_id='4494fca5-92ba-4831-8522-effa5256b8db' | ACTIVE |
| bfe1bd7c-3192-4170-9cc9-bdf011cdc585 | | fa:16:3e:95:d0:33 | ip_address='178.238.2.48', subnet_id='d447edae-1d21-4f83-9f67-2060ddb5930a' | ACTIVE |
+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+
</code></pre><ol start=3>
<li>Copy IDs of needed ports and execute the following commands.
In our case, it is a port with IP 172.16.0.164 - ClientA and 172.16.0.141 - R1:</li>
</ol>
<pre tabindex=0><code>openstack port set 5eaed158-bd0b-4e9e-88d2-7c94c124efae --disable-port-security
openstack port set 72828020-8826-4bd0-b99d-d014685678dd --disable-port-security
</code></pre><h2 id=preparing-client-side>Preparing client side</h2>
<p><strong>Client A :</strong></p>
<ol>
<li>Check connection with R1:</li>
</ol>
<pre tabindex=0><code>ping 172.16.0.141

Pinging 172.16.0.141 with 32 bytes of data:
Reply from 172.16.0.141: bytes=32 time&lt;1ms TTL=64
Reply from 172.16.0.141: bytes=32 time&lt;1ms TTL=64
Reply from 172.16.0.141: bytes=32 time&lt;1ms TTL=64
Reply from 172.16.0.141: bytes=32 time&lt;1ms TTL=64

Ping statistics for 172.16.0.141:
Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
Minimum = 0ms, Maximum = 0ms, Average = 0ms
</code></pre><ol start=2>
<li>Add route about network 172.17.0.0/24 via R1:</li>
</ol>
<pre tabindex=0><code>route ADD 172.17.0.0 MASK 255.255.255.0 172.16.0.141
</code></pre><ol start=3>
<li>Check routing table:</li>
</ol>
<pre tabindex=0><code>route print

172.16.0.255 255.255.255.255 On-link 172.16.0.164 271
172.17.0.0 255.255.255.0 172.16.0.141 172.16.0.164 16
178.238.0.0 255.255.252.0 On-link 178.238.2.48 271
178.238.2.48 255.255.255.255 On-link 178.238.2.48 271
178.238.3.255 255.255.255.255 On-link 178.238.2.48 271
224.0.0.0 240.0.0.0 On-link 127.0.0.1 331
224.0.0.0 240.0.0.0 On-link 178.238.2.48 271
224.0.0.0 240.0.0.0 On-link 172.16.0.164 271
255.255.255.255 255.255.255.255 On-link 127.0.0.1 331
255.255.255.255 255.255.255.255 On-link 178.238.2.48 271
255.255.255.255 255.255.255.255 On-link 172.16.0.164 271
</code></pre><p><strong>Client B :</strong></p>
<ol>
<li>Check connection with R2:</li>
</ol>
<pre tabindex=0><code>ping 172.17.0.179

Pinging 172.17.0.116 with 32 bytes of data:
Reply from 172.17.0.179: bytes=32 time&lt;1ms TTL=64
Reply from 172.17.0.179: bytes=32 time&lt;1ms TTL=64
Reply from 172.17.0.179: bytes=32 time&lt;1ms TTL=64
Reply from 172.17.0.179: bytes=32 time&lt;1ms TTL=64

Ping statistics for 172.17.0.179:
Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
Minimum = 0ms, Maximum = 0ms, Average = 0ms
</code></pre><ol start=2>
<li>Add route about network 172.16.0.0/24 via R2:</li>
</ol>
<pre tabindex=0><code>route ADD 172.16.0.0 MASK 255.255.255.0 172.17.0.179
</code></pre><ol start=3>
<li>Check routing table:</li>
</ol>
<pre tabindex=0><code>route print

172.16.0.0 255.255.255.0 172.17.0.179 172.17.0.116 16
172.17.0.0 255.255.255.0 On-link 172.17.0.116 271
172.17.0.116 255.255.255.255 On-link 172.17.0.116 271
172.17.0.255 255.255.255.255 On-link 172.17.0.116 271
224.0.0.0 240.0.0.0 On-link 127.0.0.1 331
224.0.0.0 240.0.0.0 On-link 88.218.54.237 271
224.0.0.0 240.0.0.0 On-link 172.17.0.116 271
255.255.255.255 255.255.255.255 On-link 127.0.0.1 331
255.255.255.255 255.255.255.255 On-link 88.218.54.237 271
255.255.255.255 255.255.255.255 On-link 172.17.0.116 271
</code></pre><h2 id=verifying-connectivity>Verifying connectivity</h2>
<p>To verify connectivity between Client A and Client B, do the following:</p>
<ol>
<li>Ping from Client B to Client A:</li>
</ol>
<pre tabindex=0><code>ping 172.16.0.164

Pinging 172.16.0.164 with 32 bytes of data:
Reply from 172.16.0.164: bytes=32 time=25ms TTL=126
Reply from 172.16.0.164: bytes=32 time=25ms TTL=126
Reply from 172.16.0.164: bytes=32 time=25ms TTL=126
Reply from 172.16.0.164: bytes=32 time=26ms TTL=126
</code></pre><ol start=2>
<li>Traceroute from Client B to Client A:</li>
</ol>
<pre tabindex=0><code>tracert -d 172.16.0.164

Tracing route to 172.16.0.164 over a maximum of 30 hops

1 &lt;1 ms &lt;1 ms &lt;1 ms 172.17.0.179
2 25 ms 25 ms 25 ms 172.16.0.141
3 26 ms 25 ms 25 ms 172.16.0.164
</code></pre>
<footer class=footline>
</footer>
</div>
</div>
<div id=navigation>
<a class="nav nav-prev" href=/tutorials-advanced/advanced-network-scenarios/ title="Advanced network scenarios"> <i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/terms-and-conditions/ title="Terms and Conditions" style=margin-right:0><i class="fa fa-chevron-right"></i></a>
</div>
</section>
<div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px>
<div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div>
</div>
<script src=/js/clipboard.min.js?1635706399></script>
<script src=/js/perfect-scrollbar.min.js?1635706399></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1635706399></script>
<script src=/js/jquery.sticky.js?1635706399></script>
<script src=/js/featherlight.min.js?1635706399></script>
<script src=/js/highlight.pack.js?1635706399></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=/js/modernizr.custom-3.6.0.js?1635706399></script>
<script src=/js/learn.js?1635706399></script>
<script src=/js/hugo-learn.js?1635706399></script>
<script src=/mermaid/mermaid.js?1635706399></script>
<script>mermaid.initialize({startOnLoad:!0})</script>
</body>
</html>