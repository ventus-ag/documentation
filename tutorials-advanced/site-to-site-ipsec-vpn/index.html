<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.147.9"><meta name=description content><link rel=icon href=/images/favicon.png type=image/png><title>The Site to Site IPSec VPN - EWW | ITandTEL Cloud Docs</title><link href=/css/nucleus.css?1751372781 rel=stylesheet><link href=/css/fontawesome-all.min.css?1751372781 rel=stylesheet><link href=/css/hybrid.css?1751372781 rel=stylesheet><link href=/css/featherlight.min.css?1751372781 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1751372781 rel=stylesheet><link href=/css/auto-complete.css?1751372781 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1751372781 rel=stylesheet><link href=/css/theme.css?1751372781 rel=stylesheet><link href=/css/tabs.css?1751372781 rel=stylesheet><link href=/css/hugo-theme.css?1751372781 rel=stylesheet><link href=/css/theme-mine.css?1751372781 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1751372781></script><style>:root #header+#content>#left>#rlblock_left{display:none !important}</style></head><body data-url=/tutorials-advanced/site-to-site-ipsec-vpn/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="206" height="52" viewBox="0 0 206 52" style="enable-background:new 0 0 206 52"><g id="Ebene_1"><g><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1=".01953125" y1="15.1895" x2="119.8848" y2="15.1895"><stop offset="0" style="stop-color:#00AEEF"/><stop offset="1" style="stop-color:#0079C1"/></linearGradient><path style="fill:#fff" d="M116.9 1.7l-6.2 13.5c-1.5 3.1-2.3 4.8-4.1 4.9-1.7-.1-2-1.5-2.5-4.9l-1-8.9c-.3-2.2-.7-5.6-3.8-5.6-3 0-4.5 3.2-5.5 5.5l-4.2 9c-1.5 3.1-2.3 4.8-4.1 4.9-1.7-.1-2-1.5-2.5-4.9l-1-8.9c-.3-2.2-.7-5.6-3.8-5.6-3 0-4.5 3.2-5.5 5.5l-4.2 9c-1.5 3.1-2.3 4.8-4.1 4.9-1.7-.1-2-1.5-2.5-4.9l-1-8.9c-.3-2.2-.7-5.6-3.8-5.6-3 0-4.5 3.2-5.6 5.5l-4.2 9c-1.5 3.1-2.3 4.8-4.1 4.9-1.7-.1-2-1.5-2.5-4.9l-1-8.9c-.3-2.2-.7-5.6-3.8-5.6-3.4.0-4.9 4.1-6 6.6-3.3 7.3-6.7 16.5-16 17.3-3.6.2-7.5-1.1-9-4.6-1.6-3.7-.3-7.9 2.3-10.8 2.1-2.3 5.5-4.3 8.8-4 2.6.3 3.7 2.8 3.2 5.1-.6 3.1-3.5 5.6-6.7 4.8-.6-.1-1.3-.6-2-.5-.8.1-1.3 1.1-1.4 1.9-.1 1.5 1 2.5 2.4 2.8 7.3 1.3 15.4-9.4 12-16.1-1.2-2.4-3.5-3.3-6-3.3h-.1c-2.8.0-5.9 1.1-7.9 2.4C4.3 5.6.0 11.8.0 18.2v.1c0 1.2.1 2.3.5 3.5 1.9 7.4 10 10 16.6 7.8 7.1-2.4 10.1-9.4 13.1-15.5.7-1.4 1.6-3.7 3.5-3.7 1.7.0 2.1 1.5 2.5 4.9l1 8.9c.3 2.2.7 5.6 3.8 5.6 3 0 4.5-3.2 5.6-5.5l4.2-9c1.5-3.1 2.3-4.8 4.1-4.9 1.7.0 2.1 1.5 2.5 4.9l1 8.9c.3 2.2.7 5.6 3.8 5.6 3 0 4.5-3.2 5.6-5.5l4.2-9c1.5-3.1 2.3-4.8 4.1-4.9 1.8.0 2.1 1.5 2.5 4.9l1 8.9c.3 2.2.7 5.6 3.8 5.6 3 0 4.5-3.2 5.5-5.5l4.2-9c1.5-3.1 2.3-4.8 4.1-4.9 1.7.0 2.1 1.5 2.5 4.9l1 8.9c.3 2.2.7 5.6 3.8 5.6 3 0 4.5-3.2 5.5-5.5l9.7-21.4C120.6.9 117.8-.1 116.9 1.7z"/><g><path style="fill:#fff" d="M73.8 49.1 76.1 38H78l-2.3 11.1H73.8z"/><path style="fill:#fff" d="M84.6 39.8l-2 9.3h-1.9l2-9.3h-3.5l.4-1.8h8.7l-.4 1.8H84.6z"/><path style="fill:#fff" d="M94.5 41.5l-1.2 5.8c-.1.5-.2.9-.2 1.4.0.1.0.2.0.4h-1.7c0-.1.0-.2.0-.3.0-.2.0-.3.0-.6-.4.6-1.1 1.1-2.1 1.1-1.9.0-3-1.5-3-3.4.0-2.5 1.7-4.6 3.9-4.6 1.4.0 2 .6 2.3 1.1l.2-.9h1.8zm-6.3 4.3c0 1.1.6 1.9 1.6 1.9 1.2.0 2.2-1.2 2.2-3 0-1-.5-1.8-1.6-1.8-1.5.0-2.2 1.6-2.2 2.9z"/><path style="fill:#fff" d="M100.1 49.1l1-4.5c0-.2.1-.3.1-.5.0-.8-.5-1.2-1.3-1.2-1 0-1.6.9-1.8 1.8l-1 4.4h-1.8l1.3-6.3c.2-.7.2-1.2.2-1.3h1.8c0 .1.0.5-.1.8.5-.7 1.4-1 2.3-1 1.4.0 2.3 1 2.3 2.4.0.2.0.6-.1.8l-1 4.6H100.1z"/><path style="fill:#fff" d="M111.1 47.3c-.1.6-.2 1.1-.2 1.4.0.0.0.3.0.4h-1.7c0-.1.0-.3.0-.4.0-.2.0-.4.0-.5-.4.6-1.1 1.1-2.1 1.1-1.9.0-3-1.5-3-3.4.0-2.5 1.7-4.6 3.9-4.6 1.3.0 2 .6 2.3 1.1l1-4.6h1.8l-2 9.5zM106 45.8c0 1.1.6 1.9 1.6 1.9 1.2.0 2.2-1.2 2.2-3 0-1-.5-1.8-1.6-1.8C106.8 42.9 106 44.5 106 45.8z"/><path style="fill:#fff" d="M119.4 39.8l-2 9.3h-1.9l2-9.3H114l.4-1.8h8.7l-.4 1.8h-3.3z"/><path style="fill:#fff" d="M122.3 49.1l2.3-11.1h6.8l-.4 1.8h-4.9l-.6 2.9h4.5l-.4 1.7h-4.4l-.6 2.9h4.9l-.4 1.8h-6.8z"/><path style="fill:#fff" d="M131.3 49.1l2.3-11.1h1.9l-2 9.3h4.9l-.4 1.8H131.3z"/></g></g></g><g id="nyt_x5F_exporter_x5F_info" style="display:none"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1751372781></script><script type=text/javascript src=/js/auto-complete.js?1751372781></script><script type=text/javascript>var baseurl="https://docs.ventuscloud.eu/"</script><script type=text/javascript src=/js/search.js?1751372781></script></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/><b>1. </b>Getting Started</a><ul><li data-nav-id=/getting-started/account/ title=Account class=dd-item><a href=/getting-started/account/>Account</a></li><li data-nav-id=/getting-started/organizations/ title=Organizations class=dd-item><a href=/getting-started/organizations/>Organizations</a></li><li data-nav-id=/getting-started/projects/ title=Projects class=dd-item><a href=/getting-started/projects/>Projects</a></li></ul></li><li data-nav-id=/identity-management/ title="Identity Management" class=dd-item><a href=/identity-management/><b>2. </b>Identity Management</a><ul><li data-nav-id=/identity-management/administrators/ title=Administrators class=dd-item><a href=/identity-management/administrators/>Administrators</a></li><li data-nav-id=/identity-management/groups/ title=Groups class=dd-item><a href=/identity-management/groups/>Groups</a></li></ul></li><li data-nav-id=/products/ title=Products class=dd-item><a href=/products/><b>3. </b>Products</a><ul><li data-nav-id=/products/compute/ title=COMPUTE class=dd-item><a href=/products/compute/><b></b>COMPUTE</a><ul><li data-nav-id=/products/compute/virtual-machines/ title="Virtual Machines" class=dd-item><a href=/products/compute/virtual-machines/>Virtual Machines</a></li><li data-nav-id=/products/compute/gpu-virtual-machines/ title="GPU Virtual Machines" class=dd-item><a href=/products/compute/gpu-virtual-machines/>GPU Virtual Machines</a></li><li data-nav-id=/products/compute/connect-linux-vm/ title="Access Linux VM" class=dd-item><a href=/products/compute/connect-linux-vm/>Access Linux VM</a></li><li data-nav-id=/products/compute/connect-windows-vm/ title="Access Windows VM" class=dd-item><a href=/products/compute/connect-windows-vm/>Access Windows VM</a></li></ul></li><li data-nav-id=/products/kubernetes/ title=KUBERNETES class=dd-item><a href=/products/kubernetes/><b></b>KUBERNETES</a><ul><li data-nav-id=/products/kubernetes/kubernetes-cluster/ title="K8S Cluster" class=dd-item><a href=/products/kubernetes/kubernetes-cluster/>K8S Cluster</a></li><li data-nav-id=/products/kubernetes/accessing-kuber/ title="Access K8S Cluster" class=dd-item><a href=/products/kubernetes/accessing-kuber/>Access K8S Cluster</a></li><li data-nav-id=/products/kubernetes/rwx-storage-class/ title="RWX Storage Class" class=dd-item><a href=/products/kubernetes/rwx-storage-class/>RWX Storage Class</a></li></ul></li><li data-nav-id=/products/databases/ title=DATABASES class=dd-item><a href=/products/databases/><b></b>DATABASES</a><ul><li data-nav-id=/products/databases/databases/ title=Databases class=dd-item><a href=/products/databases/databases/>Databases</a></li><li data-nav-id=/products/databases/database-custom-options/ title="Database's Custom Options" class=dd-item><a href=/products/databases/database-custom-options/>Database's Custom Options</a></li><li data-nav-id=/products/databases/database-replicas/ title="Database's Replicas" class=dd-item><a href=/products/databases/database-replicas/>Database's Replicas</a></li><li data-nav-id=/products/databases/database_backups/ title="Database's Backups" class=dd-item><a href=/products/databases/database_backups/>Database's Backups</a></li><li data-nav-id=/products/databases/database-management/ title="Database Management" class=dd-item><a href=/products/databases/database-management/>Database Management</a></li><li data-nav-id=/products/databases/database-user-management/ title="User Management" class=dd-item><a href=/products/databases/database-user-management/>User Management</a></li></ul></li><li data-nav-id=/products/security/ title=SECURITY class=dd-item><a href=/products/security/><b></b>SECURITY</a><ul><li data-nav-id=/products/security/firewalls/ title=Firewalls class=dd-item><a href=/products/security/firewalls/>Firewalls</a></li><li data-nav-id=/products/security/firewall-rules/ title="Firewall Rules" class=dd-item><a href=/products/security/firewall-rules/>Firewall Rules</a></li><li data-nav-id=/products/security/manage-firewalls/ title="VM's Firewalls" class=dd-item><a href=/products/security/manage-firewalls/>VM's Firewalls</a></li><li data-nav-id=/products/security/ssh-keys/ title="SSH Keys" class=dd-item><a href=/products/security/ssh-keys/>SSH Keys</a></li><li data-nav-id=/products/security/cli-users/ title="CLI Users" class=dd-item><a href=/products/security/cli-users/>CLI Users</a></li></ul></li><li data-nav-id=/products/storage/ title=STORAGE class=dd-item><a href=/products/storage/><b></b>STORAGE</a><ul><li data-nav-id=/products/storage/volumes/ title=Volumes class=dd-item><a href=/products/storage/volumes/>Volumes</a></li><li data-nav-id=/products/storage/manage-volumes/ title="VM's Volumes" class=dd-item><a href=/products/storage/manage-volumes/>VM's Volumes</a></li><li data-nav-id=/products/storage/snapshots/ title=Snapshots class=dd-item><a href=/products/storage/snapshots/>Snapshots</a></li><li data-nav-id=/products/storage/manage-snapshots/ title="VM's Snapshots" class=dd-item><a href=/products/storage/manage-snapshots/>VM's Snapshots</a></li><li data-nav-id=/products/storage/object-storage-credentials/ title="Object Storage Credentials" class=dd-item><a href=/products/storage/object-storage-credentials/>Object Storage Credentials</a></li><li data-nav-id=/products/storage/integrated-s3-browser/ title="Integrated S3-Browser" class=dd-item><a href=/products/storage/integrated-s3-browser/>Integrated S3-Browser</a></li><li data-nav-id=/products/storage/object-storage-clients/ title="Object Storage Clients" class=dd-item><a href=/products/storage/object-storage-clients/>Object Storage Clients</a></li></ul></li><li data-nav-id=/products/backups/ title=BACKUPS class=dd-item><a href=/products/backups/><b></b>BACKUPS</a><ul><li data-nav-id=/products/backups/backup-workloads/ title="Backup Workloads" class=dd-item><a href=/products/backups/backup-workloads/>Backup Workloads</a></li><li data-nav-id=/products/backups/backups/ title=Backups class=dd-item><a href=/products/backups/backups/>Backups</a></li><li data-nav-id=/products/backups/restores/ title=Restores class=dd-item><a href=/products/backups/restores/>Restores</a></li></ul></li><li data-nav-id=/products/images/ title=IMAGES class=dd-item><a href=/products/images/><b></b>IMAGES</a><ul><li data-nav-id=/products/images/custom-images/ title=Images class=dd-item><a href=/products/images/custom-images/>Images</a></li><li data-nav-id=/products/images/image-from-snapshot/ title="Create Image from Snapshot" class=dd-item><a href=/products/images/image-from-snapshot/>Create Image from Snapshot</a></li><li data-nav-id=/products/images/share-images/ title="Share Images between Projects" class=dd-item><a href=/products/images/share-images/>Share Images between Projects</a></li><li data-nav-id=/products/images/transfer-images/ title="Transfer Images between Regions" class=dd-item><a href=/products/images/transfer-images/>Transfer Images between Regions</a></li></ul></li><li data-nav-id=/products/networking/ title=NETWORKING class=dd-item><a href=/products/networking/><b></b>NETWORKING</a><ul><li data-nav-id=/products/networking/networks/ title=Networks class=dd-item><a href=/products/networking/networks/>Networks</a></li><li data-nav-id=/products/networking/floating-ips/ title="Floating IPs" class=dd-item><a href=/products/networking/floating-ips/>Floating IPs</a></li><li data-nav-id=/products/networking/routers/ title=Routers class=dd-item><a href=/products/networking/routers/>Routers</a></li><li data-nav-id=/products/networking/subnets/ title=Subnets class=dd-item><a href=/products/networking/subnets/>Subnets</a></li><li data-nav-id=/products/networking/load-balancers/ title="Load Balancers" class=dd-item><a href=/products/networking/load-balancers/>Load Balancers</a></li><li data-nav-id=/products/networking/manage-networks/ title="VM's Networks and Interfaces" class=dd-item><a href=/products/networking/manage-networks/>VM's Networks and Interfaces</a></li></ul></li></ul></li><li data-nav-id=/tutorials-advanced/ title=Advanced class="dd-item
parent"><a href=/tutorials-advanced/><b>4. </b>Advanced</a><ul><li data-nav-id=/tutorials-advanced/installation-openstack-cli/ title="Installation OpenStack CLI" class=dd-item><a href=/tutorials-advanced/installation-openstack-cli/>Installation OpenStack CLI</a></li><li data-nav-id=/tutorials-advanced/working-with-openstack-api/ title="Working with OpenStack API" class=dd-item><a href=/tutorials-advanced/working-with-openstack-api/>Working with OpenStack API</a></li><li data-nav-id=/tutorials-advanced/org-management--over-api/ title="Organization's management over API" class=dd-item><a href=/tutorials-advanced/org-management--over-api/>Organization's management over API</a></li><li data-nav-id=/tutorials-advanced/advanced-network-scenarios/ title="Advanced network scenarios" class=dd-item><a href=/tutorials-advanced/advanced-network-scenarios/>Advanced network scenarios</a></li><li data-nav-id=/tutorials-advanced/site-to-site-ipsec-vpn/ title="The Site to Site IPSec VPN" class="dd-item active"><a href=/tutorials-advanced/site-to-site-ipsec-vpn/>The Site to Site IPSec VPN</a></li></ul></li><li data-nav-id=/iac/ title="Infrastructure as code" class=dd-item><a href=/iac/><b>5. </b>Infrastructure as code</a><ul><li data-nav-id=/iac/pulumi/ title=Pulumi class=dd-item><a href=/iac/pulumi/>Pulumi</a></li><li data-nav-id=/iac/terraform/ title=Terraform class=dd-item><a href=/iac/terraform/>Terraform</a></li></ul></li></ul><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/>Home Page</a> > <a href=/tutorials-advanced/>Advanced</a> > The Site to Site IPSec VPN</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#configure-site-to-site-ipsec-connection>Configure Site to Site IPSec connection</a></li><li><a href=#strongswan-useful-commands>Strongswan useful commands</a></li><li><a href=#capture-traffic>Capture traffic</a></li><li><a href=#disable-port-security>Disable port-security</a></li><li><a href=#preparing-client-side>Preparing client side</a></li><li><a href=#verifying-connectivity>Verifying connectivity</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>The Site to Site IPSec VPN</h1><hr><p>On this page, you can find an explanation of how to configure Site to Site IPSec
connection between the Cloud Console Regions.</p><h1 id=table-of-contents>Table of contents</h1><ul><li><a href=#table-of-contents>Table of contents</a><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#configure-site-to-site-ipsec-connection>Configure Site to Site IPSec connection</a></li><li><a href=#strongswan-useful-commands>Strongswan useful commands</a></li><li><a href=#capture-traffic>Capture traffic</a></li><li><a href=#disable-port-security>Disable port-security</a></li><li><a href=#preparing-client-side>Preparing client side</a></li><li><a href=#verifying-connectivity>Verifying connectivity</a></li></ul></li></ul><h2 id=prerequisites>Prerequisites</h2><ol><li>Create a private network in each region. How to create a network see the articles - <a href=https://docs.ventuscloud.eu/products/networking/networks/>Networks</a> and <a href=https://docs.ventuscloud.eu/products/networking/subnets/>Subnets</a></li><li>Create two VMs in private and public networks based on Ubuntu 18.04 or higher in each region. How to create VMs see the article - <a href=https://docs.ventuscloud.eu/products/compute/virtual-machines/>Virtual Machines</a></li><li>For testing, need to create on each private network VM based on Windows or Linux</li></ol><h2 id=configure-site-to-site-ipsec-connection>Configure Site to Site IPSec connection</h2><p>Example network topology:
<img src="../../assets/images/tutorials/11.png?classes=border,shadow" alt></p><p><strong>Details of 2 sites</strong>:</p><p>Site A:</p><pre tabindex=0><code>Location: Gais, Switzerland
External IP: 178.238.1.68
Internal IP: 172.16.0.141
</code></pre><p>Site B:</p><pre tabindex=0><code>Location: Vienna, Austria
External IP: 88.218.54.237
Internal IP: 172.17.0.179
</code></pre><p><strong>Prerequisites for both VPN routers</strong>:</p><ol><li>Update your repository indexes and install Strongwan:</li></ol><pre tabindex=0><code>apt update &amp;&amp; sudo apt upgrade -y
apt install strongswan -y
</code></pre><ol start=2><li>Add the following kernel parameters:</li></ol><pre tabindex=0><code>cat &gt;&gt; /etc/sysctl.conf &lt;&lt; EOF
net.ipv4.ip_forward = 1
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0
EOF
</code></pre><ol start=3><li>Apply kernel parameters:</li></ol><pre tabindex=0><code>sysctl -p /etc/sysctl.conf
</code></pre><ol start=4><li>Create a preshared key that will use on both VPN routers:</li></ol><pre tabindex=0><code>openssl rand -base64 64
zfZL9********3E3EJew
</code></pre><p><strong>Configure Site A:</strong></p><ol><li>Add the following string to file /etc/ipsec.secrets</li></ol><pre tabindex=0><code>cat /etc/ipsec.secrets
# source      destination
178.238.1.68 88.218.54.237 : PSK &#34;zfZL9BtqVvCOD/zdvY4BMoDxMhUePPBS+DYxhGphXMqUZhTtMM5PEZS8zDBc3b1Vjdhev2exaPnXq+o3E3EJew&#34;
</code></pre><ol start=2><li>Add VPN configuration in /etc/ipsec.conf</li></ol><pre tabindex=0><code>cat /etc/ipsec.conf
# basic configuration
config setup
        charondebug=&#34;all&#34;
        uniqueids=yes
        strictcrlpolicy=no

# connection to amsterdam datacenter
conn gais-to-vienna
        authby=secret
        left=%defaultroute
        leftid=178.238.1.68
        leftsubnet=172.16.0.141/24
        right=88.218.55.94
        rightsubnet=172.17.0.179/24
        ike=aes256-sha2_256-modp1024!
        esp=aes256-sha2_256!
        keyingtries=0
        ikelifetime=1h
        lifetime=8h
        dpddelay=30
        dpdtimeout=120
        dpdaction=restart
        auto=start
</code></pre><p><strong>Configure Site B:</strong></p><ol><li>Add the following string to file /etc/ipsec.secrets</li></ol><pre tabindex=0><code>cat /etc/ipsec.secrets
# source      destination
88.218.54.237 178.238.1.68 : PSK &#34;zfZL9BtqVvCOD/zdvY4BMoDxMhUePPBS+DYxhGphXMqUZhTtMM5PEZS8zDBc3b1Vjdhev2exaPnXq+o3E3EJew&#34;
</code></pre><ol start=2><li>Add VPN configuration in /etc/ipsec.conf</li></ol><pre tabindex=0><code>cat /etc/ipsec.conf
# basic configuration
config setup
        charondebug=&#34;all&#34;
        uniqueids=yes
        strictcrlpolicy=no

# connection to amsterdam datacenter
conn vienna-to-gais
        authby=secret
        left=%defaultroute
        leftid=88.218.55.94
        leftsubnet=172.17.0.179/24
        right=178.238.1.68
        rightsubnet=172.16.0.194/24
        ike=aes256-sha2_256-modp1024!
        esp=aes256-sha2_256!
        keyingtries=0
        ikelifetime=1h
        lifetime=8h
        dpddelay=30
        dpdtimeout=120
        dpdaction=restart
        auto=start
</code></pre><p><strong>Start the VPN on both ends:</strong></p><pre tabindex=0><code>sudo ipsec restart
</code></pre><p><strong>Get the status of the tunnel Site A</strong>:</p><pre tabindex=0><code>sudo ipsec status
Security Associations (1 up, 0 connecting):
gais-to-vienna[294]: ESTABLISHED 4 minutes ago, 178.238.1.68[178.238.1.68]...88.218.55.94[88.218.55.94]
gais-to-vienna{285}: INSTALLED, TUNNEL, reqid 284, ESP SPIs: cdb16354_i c750e920_o
gais-to-vienna{285}: 172.16.0.0/24 === 172.17.0.0/24
</code></pre><p><strong>Get the status of the tunnel Site B</strong>:</p><pre tabindex=0><code>sudo ipsec status
Security Associations (1 up, 0 connecting):
vienna-to-gais[292]: ESTABLISHED 8 minutes ago, 88.218.55.94[88.218.55.94]...178.238.1.68[178.238.1.68]
vienna-to-gais{285}: INSTALLED, TUNNEL, reqid 284, ESP SPIs: c750e920_i cdb16354_o
vienna-to-gais{285}: 172.17.0.0/24 === 172.16.0.0/24
</code></pre><p><strong>Set the service to start on boot:</strong></p><pre tabindex=0><code>$ sudo systemctl enable strongswan
</code></pre><h2 id=strongswan-useful-commands>Strongswan useful commands</h2><ol><li>Start / Stop / Status:</li></ol><pre tabindex=0><code>sudo ipsec up connection-name
sudo ipsec down connection-name
sudo ipsec restart
sudo ipsec status
sudo ipsec statusall
</code></pre><ol start=2><li>Get the Policies and States of the IPsec Tunnel:</li></ol><pre tabindex=0><code>sudo ip xfrm state
sudo ip xfrm policy
</code></pre><ol start=3><li>Reload the secrets, while the service is running:</li></ol><pre tabindex=0><code>sudo ipsec rereadsecrets
</code></pre><h2 id=capture-traffic>Capture traffic</h2><p>To capture traffic from the tunnel, use the command:</p><pre tabindex=0><code>sudo tcpdump esp
</code></pre><h2 id=disable-port-security>Disable port-security</h2><p>To disable port-security in internal networks for VPN routers and clients, do the following:</p><ol><li><p>Create API user and install OpenStack CLI. To find more detailed instructions see the article - <a href=https://docs.ventuscloud.eu/tutorials-advanced/installation-openstack-cli/>Installation OpenStack CLI</a>.<br>In each region need to create its own API user.<br>This example shows how to disable port security in Eastern-Switzerland region.</p></li><li><p>Show port list:</p></li></ol><pre tabindex=0><code>openstack port list
+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+
| ID | Name | MAC Address | Fixed IP Addresses | Status |
+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+
| 0648a6fe-0f82-421e-8788-a3bc6ba44f14 | | fa:16:3e:36:5d:1c | ip_address=&#39;172.16.0.101&#39;, subnet_id=&#39;4494fca5-92ba-4831-8522-effa5256b8db&#39; | ACTIVE |
| 4eb09249-7800-46a1-82b5-d739af048313 | | fa:16:3e:65:05:f3 | ip_address=&#39;172.16.0.100&#39;, subnet_id=&#39;4494fca5-92ba-4831-8522-effa5256b8db&#39; | ACTIVE |
| 5e1a6b90-bc0e-40a1-811a-d20ff956fa42 | | fa:16:3e:ee:4a:66 | ip_address=&#39;172.16.0.102&#39;, subnet_id=&#39;4494fca5-92ba-4831-8522-effa5256b8db&#39; | ACTIVE |
| 5eaed158-bd0b-4e9e-88d2-7c94c124efae | | fa:16:3e:b8:9f:bf | ip_address=&#39;172.16.0.164&#39;, subnet_id=&#39;4494fca5-92ba-4831-8522-effa5256b8db&#39; | ACTIVE |
| 681ab50b-31ee-4008-b378-353fc132adbb | | fa:16:3e:42:2a:75 | ip_address=&#39;178.238.1.68&#39;, subnet_id=&#39;d447edae-1d21-4f83-9f67-2060ddb5930a&#39; | ACTIVE |
| 72828020-8826-4bd0-b99d-d014685678dd | | fa:16:3e:22:22:ea | ip_address=&#39;172.16.0.141&#39;, subnet_id=&#39;4494fca5-92ba-4831-8522-effa5256b8db&#39; | ACTIVE |
| bfe1bd7c-3192-4170-9cc9-bdf011cdc585 | | fa:16:3e:95:d0:33 | ip_address=&#39;178.238.2.48&#39;, subnet_id=&#39;d447edae-1d21-4f83-9f67-2060ddb5930a&#39; | ACTIVE |
+--------------------------------------+------+-------------------+-----------------------------------------------------------------------------+--------+
</code></pre><ol start=3><li>Copy IDs of needed ports and execute the following commands.
In our case, it is a port with IP 172.16.0.164 - ClientA and 172.16.0.141 - R1:</li></ol><pre tabindex=0><code>openstack port set 5eaed158-bd0b-4e9e-88d2-7c94c124efae --disable-port-security
openstack port set 72828020-8826-4bd0-b99d-d014685678dd --disable-port-security
</code></pre><h2 id=preparing-client-side>Preparing client side</h2><p><strong>Client A :</strong></p><ol><li>Check connection with R1:</li></ol><pre tabindex=0><code>ping 172.16.0.141

Pinging 172.16.0.141 with 32 bytes of data:
Reply from 172.16.0.141: bytes=32 time&lt;1ms TTL=64
Reply from 172.16.0.141: bytes=32 time&lt;1ms TTL=64
Reply from 172.16.0.141: bytes=32 time&lt;1ms TTL=64
Reply from 172.16.0.141: bytes=32 time&lt;1ms TTL=64

Ping statistics for 172.16.0.141:
Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
Minimum = 0ms, Maximum = 0ms, Average = 0ms
</code></pre><ol start=2><li>Add route about network 172.17.0.0/24 via R1:</li></ol><pre tabindex=0><code>route ADD 172.17.0.0 MASK 255.255.255.0 172.16.0.141
</code></pre><ol start=3><li>Check routing table:</li></ol><pre tabindex=0><code>route print

172.16.0.255 255.255.255.255 On-link 172.16.0.164 271
172.17.0.0 255.255.255.0 172.16.0.141 172.16.0.164 16
178.238.0.0 255.255.252.0 On-link 178.238.2.48 271
178.238.2.48 255.255.255.255 On-link 178.238.2.48 271
178.238.3.255 255.255.255.255 On-link 178.238.2.48 271
224.0.0.0 240.0.0.0 On-link 127.0.0.1 331
224.0.0.0 240.0.0.0 On-link 178.238.2.48 271
224.0.0.0 240.0.0.0 On-link 172.16.0.164 271
255.255.255.255 255.255.255.255 On-link 127.0.0.1 331
255.255.255.255 255.255.255.255 On-link 178.238.2.48 271
255.255.255.255 255.255.255.255 On-link 172.16.0.164 271
</code></pre><p><strong>Client B :</strong></p><ol><li>Check connection with R2:</li></ol><pre tabindex=0><code>ping 172.17.0.179

Pinging 172.17.0.116 with 32 bytes of data:
Reply from 172.17.0.179: bytes=32 time&lt;1ms TTL=64
Reply from 172.17.0.179: bytes=32 time&lt;1ms TTL=64
Reply from 172.17.0.179: bytes=32 time&lt;1ms TTL=64
Reply from 172.17.0.179: bytes=32 time&lt;1ms TTL=64

Ping statistics for 172.17.0.179:
Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
Minimum = 0ms, Maximum = 0ms, Average = 0ms
</code></pre><ol start=2><li>Add route about network 172.16.0.0/24 via R2:</li></ol><pre tabindex=0><code>route ADD 172.16.0.0 MASK 255.255.255.0 172.17.0.179
</code></pre><ol start=3><li>Check routing table:</li></ol><pre tabindex=0><code>route print

172.16.0.0 255.255.255.0 172.17.0.179 172.17.0.116 16
172.17.0.0 255.255.255.0 On-link 172.17.0.116 271
172.17.0.116 255.255.255.255 On-link 172.17.0.116 271
172.17.0.255 255.255.255.255 On-link 172.17.0.116 271
224.0.0.0 240.0.0.0 On-link 127.0.0.1 331
224.0.0.0 240.0.0.0 On-link 88.218.54.237 271
224.0.0.0 240.0.0.0 On-link 172.17.0.116 271
255.255.255.255 255.255.255.255 On-link 127.0.0.1 331
255.255.255.255 255.255.255.255 On-link 88.218.54.237 271
255.255.255.255 255.255.255.255 On-link 172.17.0.116 271
</code></pre><h2 id=verifying-connectivity>Verifying connectivity</h2><p>To verify connectivity between Client A and Client B, do the following:</p><ol><li>Ping from Client B to Client A:</li></ol><pre tabindex=0><code>ping 172.16.0.164

Pinging 172.16.0.164 with 32 bytes of data:
Reply from 172.16.0.164: bytes=32 time=25ms TTL=126
Reply from 172.16.0.164: bytes=32 time=25ms TTL=126
Reply from 172.16.0.164: bytes=32 time=25ms TTL=126
Reply from 172.16.0.164: bytes=32 time=26ms TTL=126
</code></pre><ol start=2><li>Traceroute from Client B to Client A:</li></ol><pre tabindex=0><code>tracert -d 172.16.0.164

Tracing route to 172.16.0.164 over a maximum of 30 hops

1 &lt;1 ms &lt;1 ms &lt;1 ms 172.17.0.179
2 25 ms 25 ms 25 ms 172.16.0.141
3 26 ms 25 ms 25 ms 172.16.0.164
</code></pre><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/tutorials-advanced/advanced-network-scenarios/ title="Advanced network scenarios"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/iac/ title="Infrastructure as code" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1751372781></script><script src=/js/perfect-scrollbar.min.js?1751372781></script><script src=/js/perfect-scrollbar.jquery.min.js?1751372781></script><script src=/js/jquery.sticky.js?1751372781></script><script src=/js/featherlight.min.js?1751372781></script><script src=/js/highlight.pack.js?1751372781></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1751372781></script><script src=/js/learn.js?1751372781></script><script src=/js/hugo-learn.js?1751372781></script><script src=/mermaid/mermaid.js?1751372781></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-105947713-1","auto"),ga("send","pageview")</script></body></html>