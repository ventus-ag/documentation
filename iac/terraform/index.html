<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.148.2"><meta name=description content><link rel=icon href=/images/favicon.png type=image/png><title>Terraform - EWW | ITandTEL Cloud Docs</title><link href=/css/nucleus.css?1754474755 rel=stylesheet><link href=/css/fontawesome-all.min.css?1754474755 rel=stylesheet><link href=/css/hybrid.css?1754474755 rel=stylesheet><link href=/css/featherlight.min.css?1754474755 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1754474755 rel=stylesheet><link href=/css/auto-complete.css?1754474755 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1754474755 rel=stylesheet><link href=/css/theme.css?1754474755 rel=stylesheet><link href=/css/tabs.css?1754474755 rel=stylesheet><link href=/css/hugo-theme.css?1754474755 rel=stylesheet><link href=/css/theme-mine.css?1754474755 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1754474755></script><style>:root #header+#content>#left>#rlblock_left{display:none !important}</style></head><body data-url=/iac/terraform/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=/><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="206" height="52" viewBox="0 0 206 52" style="enable-background:new 0 0 206 52"><g id="Ebene_1"><g><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1=".01953125" y1="15.1895" x2="119.8848" y2="15.1895"><stop offset="0" style="stop-color:#00AEEF"/><stop offset="1" style="stop-color:#0079C1"/></linearGradient><path style="fill:#fff" d="M116.9 1.7l-6.2 13.5c-1.5 3.1-2.3 4.8-4.1 4.9-1.7-.1-2-1.5-2.5-4.9l-1-8.9c-.3-2.2-.7-5.6-3.8-5.6-3 0-4.5 3.2-5.5 5.5l-4.2 9c-1.5 3.1-2.3 4.8-4.1 4.9-1.7-.1-2-1.5-2.5-4.9l-1-8.9c-.3-2.2-.7-5.6-3.8-5.6-3 0-4.5 3.2-5.5 5.5l-4.2 9c-1.5 3.1-2.3 4.8-4.1 4.9-1.7-.1-2-1.5-2.5-4.9l-1-8.9c-.3-2.2-.7-5.6-3.8-5.6-3 0-4.5 3.2-5.6 5.5l-4.2 9c-1.5 3.1-2.3 4.8-4.1 4.9-1.7-.1-2-1.5-2.5-4.9l-1-8.9c-.3-2.2-.7-5.6-3.8-5.6-3.4.0-4.9 4.1-6 6.6-3.3 7.3-6.7 16.5-16 17.3-3.6.2-7.5-1.1-9-4.6-1.6-3.7-.3-7.9 2.3-10.8 2.1-2.3 5.5-4.3 8.8-4 2.6.3 3.7 2.8 3.2 5.1-.6 3.1-3.5 5.6-6.7 4.8-.6-.1-1.3-.6-2-.5-.8.1-1.3 1.1-1.4 1.9-.1 1.5 1 2.5 2.4 2.8 7.3 1.3 15.4-9.4 12-16.1-1.2-2.4-3.5-3.3-6-3.3h-.1c-2.8.0-5.9 1.1-7.9 2.4C4.3 5.6.0 11.8.0 18.2v.1c0 1.2.1 2.3.5 3.5 1.9 7.4 10 10 16.6 7.8 7.1-2.4 10.1-9.4 13.1-15.5.7-1.4 1.6-3.7 3.5-3.7 1.7.0 2.1 1.5 2.5 4.9l1 8.9c.3 2.2.7 5.6 3.8 5.6 3 0 4.5-3.2 5.6-5.5l4.2-9c1.5-3.1 2.3-4.8 4.1-4.9 1.7.0 2.1 1.5 2.5 4.9l1 8.9c.3 2.2.7 5.6 3.8 5.6 3 0 4.5-3.2 5.6-5.5l4.2-9c1.5-3.1 2.3-4.8 4.1-4.9 1.8.0 2.1 1.5 2.5 4.9l1 8.9c.3 2.2.7 5.6 3.8 5.6 3 0 4.5-3.2 5.5-5.5l4.2-9c1.5-3.1 2.3-4.8 4.1-4.9 1.7.0 2.1 1.5 2.5 4.9l1 8.9c.3 2.2.7 5.6 3.8 5.6 3 0 4.5-3.2 5.5-5.5l9.7-21.4C120.6.9 117.8-.1 116.9 1.7z"/><g><path style="fill:#fff" d="M73.8 49.1 76.1 38H78l-2.3 11.1H73.8z"/><path style="fill:#fff" d="M84.6 39.8l-2 9.3h-1.9l2-9.3h-3.5l.4-1.8h8.7l-.4 1.8H84.6z"/><path style="fill:#fff" d="M94.5 41.5l-1.2 5.8c-.1.5-.2.9-.2 1.4.0.1.0.2.0.4h-1.7c0-.1.0-.2.0-.3.0-.2.0-.3.0-.6-.4.6-1.1 1.1-2.1 1.1-1.9.0-3-1.5-3-3.4.0-2.5 1.7-4.6 3.9-4.6 1.4.0 2 .6 2.3 1.1l.2-.9h1.8zm-6.3 4.3c0 1.1.6 1.9 1.6 1.9 1.2.0 2.2-1.2 2.2-3 0-1-.5-1.8-1.6-1.8-1.5.0-2.2 1.6-2.2 2.9z"/><path style="fill:#fff" d="M100.1 49.1l1-4.5c0-.2.1-.3.1-.5.0-.8-.5-1.2-1.3-1.2-1 0-1.6.9-1.8 1.8l-1 4.4h-1.8l1.3-6.3c.2-.7.2-1.2.2-1.3h1.8c0 .1.0.5-.1.8.5-.7 1.4-1 2.3-1 1.4.0 2.3 1 2.3 2.4.0.2.0.6-.1.8l-1 4.6H100.1z"/><path style="fill:#fff" d="M111.1 47.3c-.1.6-.2 1.1-.2 1.4.0.0.0.3.0.4h-1.7c0-.1.0-.3.0-.4.0-.2.0-.4.0-.5-.4.6-1.1 1.1-2.1 1.1-1.9.0-3-1.5-3-3.4.0-2.5 1.7-4.6 3.9-4.6 1.3.0 2 .6 2.3 1.1l1-4.6h1.8l-2 9.5zM106 45.8c0 1.1.6 1.9 1.6 1.9 1.2.0 2.2-1.2 2.2-3 0-1-.5-1.8-1.6-1.8C106.8 42.9 106 44.5 106 45.8z"/><path style="fill:#fff" d="M119.4 39.8l-2 9.3h-1.9l2-9.3H114l.4-1.8h8.7l-.4 1.8h-3.3z"/><path style="fill:#fff" d="M122.3 49.1l2.3-11.1h6.8l-.4 1.8h-4.9l-.6 2.9h4.5l-.4 1.7h-4.4l-.6 2.9h4.9l-.4 1.8h-6.8z"/><path style="fill:#fff" d="M131.3 49.1l2.3-11.1h1.9l-2 9.3h4.9l-.4 1.8H131.3z"/></g></g></g><g id="nyt_x5F_exporter_x5F_info" style="display:none"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1754474755></script><script type=text/javascript src=/js/auto-complete.js?1754474755></script><script type=text/javascript>var baseurl="https://docs.ventuscloud.eu/"</script><script type=text/javascript src=/js/search.js?1754474755></script></div><section id=homelinks><ul><li><a class=padding href=/><i class='fas fa-home'></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/getting-started/ title="Getting Started" class=dd-item><a href=/getting-started/><b>1. </b>Getting Started</a><ul><li data-nav-id=/getting-started/account/ title=Account class=dd-item><a href=/getting-started/account/>Account</a></li><li data-nav-id=/getting-started/organizations/ title=Organizations class=dd-item><a href=/getting-started/organizations/>Organizations</a></li><li data-nav-id=/getting-started/projects/ title=Projects class=dd-item><a href=/getting-started/projects/>Projects</a></li></ul></li><li data-nav-id=/identity-management/ title="Identity Management" class=dd-item><a href=/identity-management/><b>2. </b>Identity Management</a><ul><li data-nav-id=/identity-management/administrators/ title=Administrators class=dd-item><a href=/identity-management/administrators/>Administrators</a></li><li data-nav-id=/identity-management/groups/ title=Groups class=dd-item><a href=/identity-management/groups/>Groups</a></li></ul></li><li data-nav-id=/products/ title=Products class=dd-item><a href=/products/><b>3. </b>Products</a><ul><li data-nav-id=/products/compute/ title=COMPUTE class=dd-item><a href=/products/compute/><b></b>COMPUTE</a><ul><li data-nav-id=/products/compute/virtual-machines/ title="Virtual Machines" class=dd-item><a href=/products/compute/virtual-machines/>Virtual Machines</a></li><li data-nav-id=/products/compute/gpu-virtual-machines/ title="GPU Virtual Machines" class=dd-item><a href=/products/compute/gpu-virtual-machines/>GPU Virtual Machines</a></li><li data-nav-id=/products/compute/connect-linux-vm/ title="Access Linux VM" class=dd-item><a href=/products/compute/connect-linux-vm/>Access Linux VM</a></li><li data-nav-id=/products/compute/connect-windows-vm/ title="Access Windows VM" class=dd-item><a href=/products/compute/connect-windows-vm/>Access Windows VM</a></li></ul></li><li data-nav-id=/products/kubernetes/ title=KUBERNETES class=dd-item><a href=/products/kubernetes/><b></b>KUBERNETES</a><ul><li data-nav-id=/products/kubernetes/kubernetes-cluster/ title="K8S Cluster" class=dd-item><a href=/products/kubernetes/kubernetes-cluster/>K8S Cluster</a></li><li data-nav-id=/products/kubernetes/accessing-kuber/ title="Access K8S Cluster" class=dd-item><a href=/products/kubernetes/accessing-kuber/>Access K8S Cluster</a></li><li data-nav-id=/products/kubernetes/rwx-storage-class/ title="RWX Storage Class" class=dd-item><a href=/products/kubernetes/rwx-storage-class/>RWX Storage Class</a></li></ul></li><li data-nav-id=/products/databases/ title=DATABASES class=dd-item><a href=/products/databases/><b></b>DATABASES</a><ul><li data-nav-id=/products/databases/databases/ title=Databases class=dd-item><a href=/products/databases/databases/>Databases</a></li><li data-nav-id=/products/databases/database-custom-options/ title="Database's Custom Options" class=dd-item><a href=/products/databases/database-custom-options/>Database's Custom Options</a></li><li data-nav-id=/products/databases/database-replicas/ title="Database's Replicas" class=dd-item><a href=/products/databases/database-replicas/>Database's Replicas</a></li><li data-nav-id=/products/databases/database_backups/ title="Database's Backups" class=dd-item><a href=/products/databases/database_backups/>Database's Backups</a></li><li data-nav-id=/products/databases/database-management/ title="Database Management" class=dd-item><a href=/products/databases/database-management/>Database Management</a></li><li data-nav-id=/products/databases/database-user-management/ title="User Management" class=dd-item><a href=/products/databases/database-user-management/>User Management</a></li></ul></li><li data-nav-id=/products/security/ title=SECURITY class=dd-item><a href=/products/security/><b></b>SECURITY</a><ul><li data-nav-id=/products/security/firewalls/ title=Firewalls class=dd-item><a href=/products/security/firewalls/>Firewalls</a></li><li data-nav-id=/products/security/firewall-rules/ title="Firewall Rules" class=dd-item><a href=/products/security/firewall-rules/>Firewall Rules</a></li><li data-nav-id=/products/security/manage-firewalls/ title="VM's Firewalls" class=dd-item><a href=/products/security/manage-firewalls/>VM's Firewalls</a></li><li data-nav-id=/products/security/ssh-keys/ title="SSH Keys" class=dd-item><a href=/products/security/ssh-keys/>SSH Keys</a></li><li data-nav-id=/products/security/cli-users/ title="CLI Users" class=dd-item><a href=/products/security/cli-users/>CLI Users</a></li></ul></li><li data-nav-id=/products/storage/ title=STORAGE class=dd-item><a href=/products/storage/><b></b>STORAGE</a><ul><li data-nav-id=/products/storage/volumes/ title=Volumes class=dd-item><a href=/products/storage/volumes/>Volumes</a></li><li data-nav-id=/products/storage/manage-volumes/ title="VM's Volumes" class=dd-item><a href=/products/storage/manage-volumes/>VM's Volumes</a></li><li data-nav-id=/products/storage/snapshots/ title=Snapshots class=dd-item><a href=/products/storage/snapshots/>Snapshots</a></li><li data-nav-id=/products/storage/manage-snapshots/ title="VM's Snapshots" class=dd-item><a href=/products/storage/manage-snapshots/>VM's Snapshots</a></li><li data-nav-id=/products/storage/object-storage-credentials/ title="Object Storage Credentials" class=dd-item><a href=/products/storage/object-storage-credentials/>Object Storage Credentials</a></li><li data-nav-id=/products/storage/integrated-s3-browser/ title="Integrated S3-Browser" class=dd-item><a href=/products/storage/integrated-s3-browser/>Integrated S3-Browser</a></li><li data-nav-id=/products/storage/object-storage-clients/ title="Object Storage Clients" class=dd-item><a href=/products/storage/object-storage-clients/>Object Storage Clients</a></li></ul></li><li data-nav-id=/products/backups/ title=BACKUPS class=dd-item><a href=/products/backups/><b></b>BACKUPS</a><ul><li data-nav-id=/products/backups/backup-workloads/ title="Backup Workloads" class=dd-item><a href=/products/backups/backup-workloads/>Backup Workloads</a></li><li data-nav-id=/products/backups/backups/ title=Backups class=dd-item><a href=/products/backups/backups/>Backups</a></li><li data-nav-id=/products/backups/restores/ title=Restores class=dd-item><a href=/products/backups/restores/>Restores</a></li></ul></li><li data-nav-id=/products/images/ title=IMAGES class=dd-item><a href=/products/images/><b></b>IMAGES</a><ul><li data-nav-id=/products/images/custom-images/ title=Images class=dd-item><a href=/products/images/custom-images/>Images</a></li><li data-nav-id=/products/images/image-from-snapshot/ title="Create Image from Snapshot" class=dd-item><a href=/products/images/image-from-snapshot/>Create Image from Snapshot</a></li><li data-nav-id=/products/images/share-images/ title="Share Images between Projects" class=dd-item><a href=/products/images/share-images/>Share Images between Projects</a></li><li data-nav-id=/products/images/transfer-images/ title="Transfer Images between Regions" class=dd-item><a href=/products/images/transfer-images/>Transfer Images between Regions</a></li></ul></li><li data-nav-id=/products/networking/ title=NETWORKING class=dd-item><a href=/products/networking/><b></b>NETWORKING</a><ul><li data-nav-id=/products/networking/networks/ title=Networks class=dd-item><a href=/products/networking/networks/>Networks</a></li><li data-nav-id=/products/networking/floating-ips/ title="Floating IPs" class=dd-item><a href=/products/networking/floating-ips/>Floating IPs</a></li><li data-nav-id=/products/networking/routers/ title=Routers class=dd-item><a href=/products/networking/routers/>Routers</a></li><li data-nav-id=/products/networking/subnets/ title=Subnets class=dd-item><a href=/products/networking/subnets/>Subnets</a></li><li data-nav-id=/products/networking/manage-networks/ title="VM's Networks and Interfaces" class=dd-item><a href=/products/networking/manage-networks/>VM's Networks and Interfaces</a></li></ul></li></ul></li><li data-nav-id=/tutorials-advanced/ title=Advanced class=dd-item><a href=/tutorials-advanced/><b>4. </b>Advanced</a><ul><li data-nav-id=/tutorials-advanced/installation-openstack-cli/ title="Installation OpenStack CLI" class=dd-item><a href=/tutorials-advanced/installation-openstack-cli/>Installation OpenStack CLI</a></li><li data-nav-id=/tutorials-advanced/working-with-openstack-api/ title="Working with OpenStack API" class=dd-item><a href=/tutorials-advanced/working-with-openstack-api/>Working with OpenStack API</a></li><li data-nav-id=/tutorials-advanced/org-management--over-api/ title="Organization's management over API" class=dd-item><a href=/tutorials-advanced/org-management--over-api/>Organization's management over API</a></li><li data-nav-id=/tutorials-advanced/advanced-network-scenarios/ title="Advanced network scenarios" class=dd-item><a href=/tutorials-advanced/advanced-network-scenarios/>Advanced network scenarios</a></li><li data-nav-id=/tutorials-advanced/site-to-site-ipsec-vpn/ title="The Site to Site IPSec VPN" class=dd-item><a href=/tutorials-advanced/site-to-site-ipsec-vpn/>The Site to Site IPSec VPN</a></li></ul></li><li data-nav-id=/iac/ title="Infrastructure as code" class="dd-item
parent"><a href=/iac/><b>5. </b>Infrastructure as code</a><ul><li data-nav-id=/iac/pulumi/ title=Pulumi class=dd-item><a href=/iac/pulumi/>Pulumi</a></li><li data-nav-id=/iac/terraform/ title=Terraform class="dd-item active"><a href=/iac/terraform/>Terraform</a></li></ul></li></ul><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/>Home Page</a> > <a href=/iac/>Infrastructure as code</a> > Terraform</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#prepare-terraform-environment>Prepare Terraform environment</a></li><li><a href=#basic-virtual-machine-setup>Basic virtual machine setup</a></li><li><a href=#complex-virtual-machine-setup>Complex virtual machine setup</a></li><li><a href=#basic-kubernetes-setup>Basic Kubernetes setup</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Terraform</h1><hr><p>On this page, you can find essential steps and code for starting with Terraform and Cloud, from installation to advanced deployment scenarios, highlighting the benefits of infrastructure as code (IaC) for simplifying and automating cloud infrastructure management.</p><h1 id=table-of-contents>Table of contents</h1><ul><li><a href=#table-of-contents>Table of contents</a><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#prepare-terraform-environment>Prepare Terraform environment</a></li><li><a href=#basic-virtual-machine-setup>Basic virtual machine setup</a></li><li><a href=#complex-virtual-machine-setup>Complex virtual machine setup</a></li><li><a href=#basic-kubernetes-setup>Basic Kubernetes setup</a></li></ul></li></ul><h2 id=prerequisites>Prerequisites</h2><ul><li><strong>Terraform installation</strong> - <a href=https://developer.hashicorp.com/terraform/install>https://developer.hashicorp.com/terraform/install</a></li><li><strong>Create CLI user</strong> - <a href=https://docs.ventuscloud.eu/products/security/cli-users>https://docs.ventuscloud.eu/products/security/cli-users</a></li><li><strong>Install CLI client</strong> - <a href=https://docs.ventuscloud.eu/tutorials-advanced/installation-openstack-cli/>https://docs.ventuscloud.eu/tutorials-advanced/installation-openstack-cli/</a></li></ul><h2 id=prepare-terraform-environment>Prepare Terraform environment</h2><ol><li>Set Up Your Environment
Once Terraform is installed, create a new directory for your Terraform configurations. This directory will hold all your Terraform files for a specific project:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir terraform_basic_vm
</span></span><span style=display:flex><span>cd terraform_basic_vm
</span></span></code></pre></div><ol start=2><li>Create file provider.tf in terraform_basic_vm folder and add following code:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#a6e22e>terraform</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>required_version</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&gt;= 0.14.0&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>required_providers</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>openstack</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>source</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;terraform-provider-openstack/openstack&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>version</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;~&gt; 1.53.0&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is a configuration block for Terraform, an infrastructure as code tool used for building, changing, and versioning infrastructure safely and efficiently. We will use it in all our examples.</p><p>In this specific block:</p><ul><li><p><code>required_version</code>: Specifies the minimum version of Terraform required to run this configuration. In this case, it requires version 0.14.0 or newer.</p></li><li><p><code>required_providers</code>: Specifies the providers required by this configuration. Providers are plugins that Terraform uses to interact with different infrastructure APIs. In this block:</p><ul><li><code>openstack</code>: Specifies the provider for OpenStack, a cloud computing platform. It includes:<ul><li><code>source</code>: Specifies where Terraform can find the provider plugin. In this case, it&rsquo;s hosted on the official Terraform registry under the namespace <code>terraform-provider-openstack/openstack</code>.</li><li><code>version</code>: Specifies the version constraint for the provider. In this case, it requires version 1.53.0 or newer, but not version 2.0.0.</li></ul></li></ul></li></ul><p>Overall, this configuration ensures that when you run Terraform commands against this project, Terraform will check that it&rsquo;s using at least version 0.14.0 and that it has the required OpenStack provider version installed to manage the OpenStack infrastructure.</p><ol start=3><li>Create file outputs.tf in terraform_basic_vm folder and add following code. We will use it on first and second examples.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;instance_ip&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>openstack_compute_instance_v2</span>.<span style=color:#a6e22e>example_instance</span>.<span style=color:#a6e22e>access_ip_v4</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><p><code>output "instance_ip"</code>: This line declares an output variable named &ldquo;instance_ip&rdquo;. Outputs in Terraform allow you to extract and display specific information from your infrastructure after it&rsquo;s been created or modified.</p></li><li><p><code>value = openstack_compute_instance_v2.example_instance.access_ip_v4</code>: This line specifies the value of the output variable. It retrieves the IPv4 address (<code>access_ip_v4</code>) of an OpenStack compute instance named <code>example_instance</code>. The <code>openstack_compute_instance_v2</code> is a Terraform resource type that represents an OpenStack compute instance.</p></li></ul><p>Overall, this output configuration retrieves and displays the IPv4 address of an OpenStack compute instance named <code>example_instance</code>. After applying the Terraform configuration, you can use the <code>terraform output</code> command to view the value of the &ldquo;instance_ip&rdquo; output variable.</p><ol start=4><li>First set the required environment variables for the OpenStack provider by sourcing the credentials file. (see <a href=https://docs.ventuscloud.eu/products/security/cli-users>https://docs.ventuscloud.eu/products/security/cli-users</a>)</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>source openrc
</span></span></code></pre></div><ol start=5><li><p>Create a new file named main.tf in terraform_basic_vm folder. This file will contain your Terraform configuration. You can use code from first example.</p></li><li><p>Create id_rsa.pub file and put inside public key (it can be created in another path, do not forger define path in public_key = file("/path_to_file/id_rsa.pub") )</p></li></ol><div class="notices note"><p>The first two examples (Basic virtual machine setup and Complex virtual machine setup) imply that all 6 steps have been completed;<br>In the third example (Basic Kubernetes setup), you need to skip the third step, since all the necessary information for connecting to the k8s cluster will be saved to a file.</p></div><ol start=7><li>Initialize Terraform
Before applying the configuration, you need to initialize Terraform in your project directory. This step downloads the necessary plugins and initializes your working directory.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform init
</span></span></code></pre></div><ol start=8><li>After initializing add code in main.tf and create an execution plan and apply your Terraform configuration. This command generates an execution plan based on your configuration files. It outlines what actions Terraform will take to achieve the desired state:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform plan
</span></span></code></pre></div><ol start=9><li>Next command applies the execution plan generated by terraform plan. Terraform will prompt you to confirm the action. Type yes and press Enter to proceed.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform apply
</span></span></code></pre></div><ol start=10><li>Clean Up (optional)</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform destroy
</span></span></code></pre></div><h2 id=basic-virtual-machine-setup>Basic virtual machine setup</h2><ol><li><p>SSH Key Pair Creation</p><ul><li>A SSH key pair named &ldquo;example-keypair&rdquo; is created using the <code>openstack_compute_keypair_v2</code> resource.</li><li>The public key is fetched from the file &ldquo;./id_rsa.pub&rdquo;.</li></ul></li><li><p>Security Group Creation</p><ul><li>A security group named &ldquo;sec_group&rdquo; is created using the <code>openstack_networking_secgroup_v2</code> resource.</li><li>This security group will control inbound and outbound traffic for instances associated with it.</li></ul></li><li><p>Ingress Rules Configuration</p><ul><li>Two ingress rules are added to the &ldquo;sec_group&rdquo; security group using <code>openstack_networking_secgroup_rule_v2</code> resources:<ul><li>The first rule allows SSH (TCP port 22) traffic from any IP address (0.0.0.0/0).</li><li>The second rule allows ICMP (ping) traffic from any IP address (0.0.0.0/0).</li></ul></li></ul></li><li><p>Instance Creation</p><ul><li>An OpenStack compute instance named &ldquo;example-instance&rdquo; is created using the <code>openstack_compute_instance_v2</code> resource.</li><li>The instance is launched from the &ldquo;ubuntu-server-22.04-LTS-20240110&rdquo; image and uses the &ldquo;VC-2&rdquo; flavor.</li><li>It is associated with the &ldquo;public&rdquo; network.</li><li>The SSH key pair &ldquo;example-keypair&rdquo; and the security group &ldquo;sec_group&rdquo; are attached to the instance, allowing SSH access and controlling inbound and outbound traffic.</li></ul></li></ol><p>This code can be used to provision resources in the cloud, including creating VM instance with SSH access configured via key pairs and security groups. Adjustments can be made to customize the deployment according to specific requirements.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#75715e>// Add ssh public key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_compute_keypair_v2&#34;</span> <span style=color:#e6db74>&#34;example_keypair&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;example-keypair&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>public_key</span> <span style=color:#f92672>=</span> file(<span style=color:#e6db74>&#34;./id_rsa.pub&#34;</span>)<span style=color:#75715e> // or can be public_key =(&#34;ssh-rsa AAAAB3.......&#34;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>//Create security group with name sec_group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_networking_secgroup_v2&#34;</span> <span style=color:#e6db74>&#34;sec_group&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sec_group&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Master sec group&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>//Add ingress rule ssh in security group with name sec_group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_networking_secgroup_rule_v2&#34;</span> <span style=color:#e6db74>&#34;allow_ssh&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>direction</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ingress&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ethertype</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;IPv4&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>protocol</span>          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port_range_min</span>    <span style=color:#f92672>=</span> <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port_range_max</span>    <span style=color:#f92672>=</span> <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>remote_ip_prefix</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span><span style=color:#75715e> //For more secure add your IP/32
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>security_group_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>openstack_networking_secgroup_v2</span>.<span style=color:#a6e22e>sec_group</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>//Add ingress rule ICMP all options in security group with name sec_group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_networking_secgroup_rule_v2&#34;</span> <span style=color:#e6db74>&#34;allow_icmp&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>direction</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ingress&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ethertype</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;IPv4&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>protocol</span>          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;icmp&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>remote_ip_prefix</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span><span style=color:#75715e> //For more secure add your IP/32
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>security_group_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>openstack_networking_secgroup_v2</span>.<span style=color:#a6e22e>sec_group</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>//Create instance with name example_instance in public network with ssh key and security group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_compute_instance_v2&#34;</span> <span style=color:#e6db74>&#34;example_instance&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;example-instance&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>image_name</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ubuntu-server-22.04-LTS-20240110&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>flavor_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;VC-2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>key_pair</span>    <span style=color:#f92672>=</span> <span style=color:#a6e22e>openstack_compute_keypair_v2</span>.<span style=color:#a6e22e>example_keypair</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>security_groups</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>openstack_networking_secgroup_v2</span>.<span style=color:#a6e22e>sec_group</span>.<span style=color:#a6e22e>name</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>network</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;public&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=complex-virtual-machine-setup>Complex virtual machine setup</h2><ol><li><p>SSH Key Pair Creation</p><ul><li>A SSH key pair named &ldquo;example-keypair&rdquo; is created using the <code>openstack_compute_keypair_v2</code> resource.</li><li>The public key is fetched from the file &ldquo;./id_rsa.pub&rdquo;.</li></ul></li><li><p>Security Group Creation</p><ul><li>A security group named &ldquo;sec_group&rdquo; is created using the <code>openstack_networking_secgroup_v2</code> resource.</li><li>This security group will control inbound and outbound traffic for instances associated with it.</li></ul></li><li><p>Ingress Rules Configuration</p><ul><li>Three ingress rules are added to the &ldquo;sec_group&rdquo; security group using <code>openstack_networking_secgroup_rule_v2</code> resources:<ul><li>The first rule allows SSH (TCP port 22) traffic from any IP address (0.0.0.0/0).</li><li>The second rule allows HTTP (TCP port 80) traffic from any IP address (0.0.0.0/0).</li><li>The third rule allows HTTPS (TCP port 443) traffic from any IP address (0.0.0.0/0).</li></ul></li><li>Additionally, an ingress rule allows ICMP (ping) traffic from any IP address (0.0.0.0/0).</li></ul></li><li><p>Instance Creation</p><ul><li>An OpenStack compute instance named &ldquo;example-instance&rdquo; is created using the <code>openstack_compute_instance_v2</code> resource.</li><li>The instance is launched from the &ldquo;ubuntu-server-22.04-LTS-20240110&rdquo; image and uses the &ldquo;VC-2&rdquo; flavor.</li><li>It is associated with the &ldquo;public&rdquo; network.</li><li>The SSH key pair &ldquo;example-keypair&rdquo; and the security group &ldquo;sec_group&rdquo; are attached to the instance, allowing SSH access and controlling inbound and outbound traffic.</li><li>Cloud-init configuration is provided via the <code>user_data</code> attribute, which installs Nginx and enables unattended upgrades.</li></ul></li></ol><p>This code can be used to provision resources in the cloud, including creating VM instance with SSH and Web access configured via key pairs and security groups. Adjustments can be made to customize the deployment according to specific requirements.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#75715e>//Extended VM creation (cloud init + couple rules in sec group)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_compute_keypair_v2&#34;</span> <span style=color:#e6db74>&#34;example_keypair&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;example-keypair&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>public_key</span> <span style=color:#f92672>=</span> file(<span style=color:#e6db74>&#34;./id_rsa.pub&#34;</span>)
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>//Create security group with name sec_group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_networking_secgroup_v2&#34;</span> <span style=color:#e6db74>&#34;sec_group&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sec_group&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Master sec group&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>//Add ingress rule ssh in security group with name sec_group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_networking_secgroup_rule_v2&#34;</span> <span style=color:#e6db74>&#34;allow_ssh&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>direction</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ingress&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ethertype</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;IPv4&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>protocol</span>          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port_range_min</span>    <span style=color:#f92672>=</span> <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port_range_max</span>    <span style=color:#f92672>=</span> <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>remote_ip_prefix</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span><span style=color:#75715e> //For more secure add your IP/32
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>security_group_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>openstack_networking_secgroup_v2</span>.<span style=color:#a6e22e>sec_group</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>//Add ingress rule http in security group with name sec_group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_networking_secgroup_rule_v2&#34;</span> <span style=color:#e6db74>&#34;allow_http&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>direction</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ingress&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ethertype</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;IPv4&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>protocol</span>          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port_range_min</span>    <span style=color:#f92672>=</span> <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port_range_max</span>    <span style=color:#f92672>=</span> <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>remote_ip_prefix</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span><span style=color:#75715e> //For more secure add your IP/32
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>security_group_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>openstack_networking_secgroup_v2</span>.<span style=color:#a6e22e>sec_group</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>//Add ingress rule https in security group with name sec_group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_networking_secgroup_rule_v2&#34;</span> <span style=color:#e6db74>&#34;allow_https&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>direction</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ingress&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ethertype</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;IPv4&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>protocol</span>          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port_range_min</span>    <span style=color:#f92672>=</span> <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port_range_max</span>    <span style=color:#f92672>=</span> <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>remote_ip_prefix</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span><span style=color:#75715e> //For more secure add your IP/32
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>security_group_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>openstack_networking_secgroup_v2</span>.<span style=color:#a6e22e>sec_group</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>//Add ingress rule ICMP all options in security group with name sec_group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_networking_secgroup_rule_v2&#34;</span> <span style=color:#e6db74>&#34;allow_icmp&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>direction</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ingress&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ethertype</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;IPv4&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>protocol</span>          <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;icmp&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>remote_ip_prefix</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span><span style=color:#75715e> //For more secure add your IP/32
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>security_group_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>openstack_networking_secgroup_v2</span>.<span style=color:#a6e22e>sec_group</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_compute_instance_v2&#34;</span> <span style=color:#e6db74>&#34;example_instance&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;example-instance&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>image_name</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ubuntu-server-22.04-LTS-20240110&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>flavor_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;VC-2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>key_pair</span>    <span style=color:#f92672>=</span> <span style=color:#a6e22e>openstack_compute_keypair_v2</span>.<span style=color:#a6e22e>example_keypair</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>security_groups</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>openstack_compute_secgroup_v2</span>.<span style=color:#a6e22e>sec_group</span>.<span style=color:#a6e22e>name</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>network</span> {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;public&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>user_data</span> <span style=color:#f92672>=</span> <span style=color:#f92672>&lt;&lt;-EOF</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              #cloud-config
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              packages:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                - nginx
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                - unattended-upgrades
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              package_update: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              package_upgrade: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              </span><span style=color:#f92672>EOF</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=basic-kubernetes-setup>Basic Kubernetes setup</h2><ol><li><p>Keypair Creation:
An OpenStack compute SSH key pair named &ldquo;example-keypair&rdquo; is created using the <code>openstack_compute_keypair_v2</code> resource.</p><ul><li>The name of the key pair is set to &ldquo;example-keypair&rdquo;.</li><li>The public key is read from the file &ldquo;./id_rsa.pub&rdquo;.</li></ul></li><li><p>Kubernetes Cluster Creation:
An OpenStack Container Infrastructure (COI) cluster named &ldquo;cluster_1&rdquo; is created using the <code>openstack_containerinfra_cluster_v1</code> resource.</p><ul><li>The name of the cluster is set to &ldquo;cluster_1&rdquo;.</li><li>It is based on the cluster template with ID &ldquo;v1.28.4&rdquo;.</li><li>One master node and one worker node are provisioned.</li><li>The SSH key pair &ldquo;example-keypair&rdquo; is used for authentication.</li><li>The master node is configured with flavor &ldquo;VC-4&rdquo; and the worker node with flavor &ldquo;VC-2&rdquo;.</li><li>Floating IP is enabled for the cluster.</li></ul></li><li><p>Get Kubernetes Configuration
A null resource named &ldquo;get_kubeconfig&rdquo; is used to execute a local command to retrieve the Kubernetes configuration.</p><ul><li>It depends on the creation of the Kubernetes cluster resource.</li><li>The command executed is &ldquo;mkdir -p ./kubeconfig && openstack coe cluster config ${openstack_containerinfra_cluster_v1.cluster_1.name} &ndash;dir ./kubeconfig&rdquo;, which creates a directory for the Kubernetes configuration and fetches it using the OpenStack client.</li></ul></li></ol><p>This code can be used to provision resources in the cloud, including creating k8s cluster. Adjustments can be made to customize the deployment according to specific requirements.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#75715e>#Keypair
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_compute_keypair_v2&#34;</span> <span style=color:#e6db74>&#34;example_keypair&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;example-keypair&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>public_key</span> <span style=color:#f92672>=</span> file(<span style=color:#e6db74>&#34;./id_rsa.pub&#34;</span>)
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#Create k8s cluster
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;openstack_containerinfra_cluster_v1&#34;</span> <span style=color:#e6db74>&#34;cluster_1&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>                <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;cluster_1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cluster_template_id</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;v1.28.4&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>master_count</span>        <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>node_count</span>          <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>keypair</span>             <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;example-keypair&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>master_flavor</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;VC-4&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>flavor</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;VC-2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>floating_ip_enabled</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>//Get configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;null_resource&#34;</span> <span style=color:#e6db74>&#34;get_kubeconfig&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depends_on</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>openstack_containerinfra_cluster_v1</span>.<span style=color:#a6e22e>cluster_1</span>]
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>provisioner</span> <span style=color:#e6db74>&#34;local-exec&#34;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>command</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;mkdir -p ./kubeconfig &amp;&amp; openstack coe cluster config </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>openstack_containerinfra_cluster_v1</span>.<span style=color:#a6e22e>cluster_1</span>.<span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74> --dir ./kubeconfig&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/iac/pulumi/ title=Pulumi><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/iac/pulumi/ title=Pulumi style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1754474755></script><script src=/js/perfect-scrollbar.min.js?1754474755></script><script src=/js/perfect-scrollbar.jquery.min.js?1754474755></script><script src=/js/jquery.sticky.js?1754474755></script><script src=/js/featherlight.min.js?1754474755></script><script src=/js/highlight.pack.js?1754474755></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1754474755></script><script src=/js/learn.js?1754474755></script><script src=/js/hugo-learn.js?1754474755></script><script src=/mermaid/mermaid.js?1754474755></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-105947713-1","auto"),ga("send","pageview")</script></body></html>